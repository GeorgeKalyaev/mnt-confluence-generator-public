"""Дефолтные значения для предзаполнения МНТ"""

# Дефолтные значения для таблицы сокращений (3.1)
DEFAULT_ABBREVIATIONS = """HTTP|Протокол прикладного уровня передачи данных (Hypertext Transfer Protocol)
HTML|HyperText Markup Language - стандартизованный язык разметки документов во Всемирной паутине
RPS|Число запросов в секунду (Requests Per Second)
SLA|Соглашение об уровне обслуживания, описывающие требуемые параметры работы системы (Service Level Agreement)
UC|Сценарий использования (пользовательский сценарий) (Use Case)
UI|Пользовательский интерфейс (User Interface)
VU|Виртуальный пользователь (Virtual User)
АС|Автоматизированная система
БД,DB|База данных
БП|Бизнес-процесс
МНТ|Методика нагрузочного тестирования
ИС|Информационная система
ПО|Программное обеспечение
СНТ|Средства нагрузочного тестирования
СУБД|Система управления базами данных
ЧПН|Час пиковой нагрузки
УКП|Управляющая компания «Первая»
ЦП/CPU|Центральный процессор
ОП/RAM|Оперативная память
НДФЛ|Налог на доходы физических лиц А так же одноимённая ИС для его автоматизированного расчета"""

# Дефолтные значения для таблицы терминологии (3.2)
# Формат: Термин|Определение (каждая строка - отдельная запись)
DEFAULT_TERMINOLOGY = """Бизнес-процесс, пользовательский сценарий|Последовательность связанных активностей (шагов), исполняемых сотрудниками или системами, имеющая внутреннее устройство и результат, представляющие ценность для бизнеса
Автоматизированная система|Совокупность прикладного программного обеспечения, являющаяся предметом исследования в проекте нагрузочного тестирования
Бизнес-процесс, пользовательский сценарий|Последовательность связанных активностей (шагов), исполняемых сотрудниками или системами, имеющая внутреннее устройство и результат, представляющие ценность для бизнеса
Виртуальный пользователь|Программный процесс, моделирующий работу одного пользователя/подключения к АС. Виртуальный пользователь циклически выполняет операции моделируемого пользовательского сценария использования автоматизированной системы
Время отклика|Время реакции системы на транзакцию
Интенсивность выполнения операции|Количество операций, выполняемых в единицу времени, в тестовом скрипте задается интервалом времени между итерациями. Обычно измеряется в оп/час, оп/мин, оп/сек
Итерация|Один повтор, выполняемый одним виртуальным пользователем моделируемого пользовательского сценария
Качество обслуживания (SLA)|Совокупность показателей, характеризующих возможность обработки системой операций с приемлемой/требуемой длительностью обработки и количеством сбойных операций (отказы в обслуживании)
Максимальная производительность|Наивысшая интенсивность выполнения операций, обслуживаемых системой с соблюдением требуемого качества обслуживания (удовлетворяет SLA)
Массовые операции|Подразумеваются самые часто используемые/интенсивные операции в системе
Модель нагрузки|Набор профилей нагрузки, наиболее точно характеризующих работу
Нагрузка|Совокупная интенсивность операций, поступающих на обработку в АС
Надежность|Возможность АС работать продолжительное время под нагрузкой
Отказоустойчивость|Возможность системы сохранять работоспособность в случае отказа/сбоев одной или нескольких смежных систем
Пейсинг (Pacing)|Временной интервал между началом двух последовательных итераций виртуального пользователя
Перцентиль|Характеристики набора данных, выражаемое рангами от 1 до 100. Эти характеристики являются показателями, какой процент значений находится ниже определенного уровня. 90 перцентиль означает, что 90% значений находится ниже этого уровня. На практике перцентиль используется для фильтрации среднего значения по измеряемой метрике за время теста без учета отдельных всплесков
Пиковая производительность|Наивысшая интенсивность выполнения операций, возможно, с нарушением требуемого качества обслуживания, после которой наступает деградация системы, т.е. интенсивность успешно выполняемых операций либо не увеличивается, либо уменьшается
Производительность|Характеристика системы определяющая возможность системы обрабатывать определенное количество операций в АС за период времени
Профиль нагрузки|Набор операций с заданными интенсивностями, полученный на основе сбора статистических данных либо определённый путём анализа требований к тестируемой системе
Скрипт|Скрипт на языке ПО нагрузочного тестирования либо на языке программирования общего назначения, содержащий код для эмуляции работы с системой
Средства нагрузочного тестирования|Скрипты и сценарии создания нагрузки, средства подготовки БД, средства подготовки тестовых данных, эмуляторы, средства мониторинга
Стабильность|Возможность АС работать продолжительное время под нагрузкой
Сценарии нагрузочного тестирования|Описание, содержащее количества виртуальных пользователей, их логику работы, интенсивности выполнения операций
Типичная (средняя) нагрузка|Нагрузка, определяемая наиболее характерным режимом эксплуатации системы, при котором система будет работать обычный день. При расчете типичного уровня нагрузки периоды времени минимальных и максимальных нагрузок не учитываются
Транзакция|Одна или несколько операций бизнес-процесса, объединенных под общим логическим названием выполняемого шага виртуального пользователя или системы
Тяжелые операции|Подразумеваются операции, которые больше всего нагружают систему
Узкое место|Фактор ограничения производительности или пропускной способности системы одним или несколькими компонентами или ресурсами
Уровень нагрузки|Основной показатель нагрузки (обычно суммарная интенсивность поступающих на обработку операций), относительно которого, в соответствии с заданным профилем нагрузки, определяется интенсивность каждого отдельного вида операций
Эмулятор, заглушка (stub)|Минимальная специализированного реализация программного компонента, использующаяся для подмены компонента, от которого зависит тестирование АС"""

# Дефолтный текст введения (4)
DEFAULT_INTRODUCTION = """В настоящем документе описаны и определены стратегия и принципы нагрузочного тестирования системы «указываем название системы» (далее упоминается как «Система» или «Продукт»). 
Методика нагрузочного тестирования разрабатывается для решения следующих задач:
Документ преследует следующие цели:
• Определить содержание работ, описать методологию и стратегию тестирования систем.
• Определить имеющиеся ограничения, порядок выполнения тестов и обработки результатов.
• Описать объект исследования и конфигурацию тестового стенда.
Методика нагрузочного тестирования предназначена для специалистов бизнес-подразделений, менеджеров и технических специалистов Заказчика, а также будет использоваться при проектировании и проведении тестов."""

# Дефолтные задачи НТ (5.2)
DEFAULT_TASKS_NT = """1. Разработать и согласовать методику нагрузочного тестирования, описывающей стратегию и подходы к проведению нагрузочного тестирования на каждом этапе.
2. Составить профиль нагрузки на систему.
3. Разработать средства НТ и подготовить тестовую среду.
4. При необходимости разработать необходимые эмуляторы и заглушки внешних систем (если таковы требуются) на основе согласованного списка операций системы.
5. Установить и настроить систему мониторинга.
6. Проанализировать предоставленные заказчиком данные, с целью определения целей тестирования, моделируемых операций, их объёма и интенсивности.
7. Провести тесты НТ описанные в пункте 9.1:
8. Проанализировать проведенные тесты и составить отчёт, включающий в себя:
   • заключение по успешности прохождения системой нагрузочных испытаний;
   • выводы по каждому проведенному тесту;
   • список обнаруженных узких мест и список рекомендаций по их устранению;
   • описание и результаты проведенных тестов."""

# Дефолтные ограничения НТ (6.1)
DEFAULT_LIMITATIONS = """1. Проект по нагрузочному тестированию не предполагает функционального тестирования Системы, не описывает методы и способы выявления функциональных дефектов. Тем не менее, все обнаруженные в ходе проведения тестирования дефекты регистрируются в отчете и передаются специалистам Разработчика Системы. На точность НТ не влияет;
2. НТ не направлено на выявление дефектов в аппаратной части стенда;
3. В НТ не учитывается стороннее влияние на каналы связи;
4. НТ определяет параметры производительности исключительно пользовательских операций и не направлено на определение параметров системных и административных операций;
5. Дополнительные активности тестирования, не описанные в МНТ, должны быть согласованы. При этом сроки НТ сдвигаются;
6. При невозможности выполнить какие-либо работы по НТ по причинам неработоспособности тестируемой системы или тестового стенда – все выявленные дефекты и причины невыполнения работ фиксируются в отчете тестирования;
7. При обнаружении «узких» мест, которые являются критичными или блокирующими для проведения НТ, Исполнитель информирует Заказчика о невозможности проведения тестирования. В случае, если выявленный дефект оказывает значительное влияние на результаты тестирования и его устранение по каким-либо причинам невозможно, то по согласованию с Заказчиком вводится дополнительное ограничение НТ;
8. Стратегия НТ может быть пересмотрена и скорректирована в ходе проекта (по результатам получения актуализированной информации, актуализированных целей и т.д.). Все изменения предварительно согласовываются с Заказчиком;
9. НТ не является интеграционным и не направлено на выявление дефектов интеграционного взаимодействия. Внешние системы в составе тестового контура заменяются эмуляторами (если таковы имеются);
10. Продолжение работ по окончании проекта возможно по дополнительному согласованию между Исполнителем и Заказчиком;
11. Тестирование производится на основе статистики использования системы на продуктивном контуре и собирается с помощью Яндекс.Метрик. Результаты тестирования могут отличаться от результатов, полученных в промышленных условиях;
12. Во время проведения тестирования версии компонент ИС изменяются только в случае необходимости устранения ошибок, мешающих дальнейшему проведению работ по тестированию. Изменения с целью улучшения работы этих компонентов и ускорения выполнения бизнес-операций должны проводится после завершения цикла тестирования;
13. Профиль нагрузки может быть скорректирован после получения обновленной статистики или бизнес прогнозов по интенсивности выполнения;
14. В ходе нагрузочного тестирования ИБ-сканер будет активен, что может сказаться на результатах НТ;
15. Конфигурация настроек стенда НТ может отличаться от конфигурации продуктовой среды;
16. Нагрузочное тестирование производится на локальной машине сотрудника, а не на нагрузочных станциях;
17. Неравномерное распределение нагрузки на ноды как архитектурная особенность системы, обусловленная применением VirtualIP"""

# Дефолтная таблица рисков (6.2)
DEFAULT_RISKS_TABLE = """Риск|Вероятность возникновения|Влияние
При подготовке СНТ возможно изменение функционала ИС, что потребует дополнительных ресурсов на актуализацию МНТ, заглушек и портов.|Средняя|Сроки НТ
Отсутствие информации, необходимой для создания методики (статистики, сценариев использования, техническая информация об объекте НТ).|Низкая|Качество МНТ и НТ
Наличие дефектов функционала, мешающих разработке СНТ или проведению НТ.|Средняя|Сроки НТ
Отсутствие необходимых прав для настройки мониторинга на тестовом стене.|Низкая|Сроки НТ
Задержка согласования Заказчиком документации по проекту.|Низкая|Сроки НТ
Неработоспособность тестового контура.|Средняя|Сроки НТ
При подготовке СНТ стенд будет выделен позже запланированного.|Средняя|Сроки НТ
Получение нерелевантных результатов тестирования из-за низкой производительности тестовой среды.|Высокая|Качество НТ
Сторонняя нагрузка на тестовую инфраструктуру во время проведения тестов.|Низкая|Качество НТ
Отсутствие доступа к различным внутренним сервисам.|Низкая|Качество НТ
Методика тестирования может быть пересмотрена и скорректирована по согласованию с Заказчиком.|Низкая|Сроки НТ
В ходе НТ ИБ-сканер будет активен, что может сказаться на результатах НТ.|Высокая|Качество НТ"""

# Дефолтный текст общих сведений (7.1)
DEFAULT_OBJECT_GENERAL = """Объектом тестирования является связка программных и аппаратных средств, обеспечивающая работу системы «указываем название системы»."""

# Дефолтный текст архитектуры тестового стенда (8.1)
DEFAULT_TEST_STAND_ARCHITECTURE = """Подготовка и проведение нагрузочного тестирования производятся на фиксированной конфигурации тестового стенда Заказчика, расположенного на территории Заказчика. За подготовку (сборку, настройку, установку системного ПО, развертывание тестируемых подсистем) тестового стенда отвечает Заказчик нагрузочного тестирования."""

# Дефолтный текст наполнения БД (10)
DEFAULT_DATABASE_PREPARATION = """Наполнение БД дополнительными тестовыми данными, а также генерация очередей данных в случае необходимости производятся с помощью скриптов, разработанных Исполнителем. Необходимы данные пользователя БД с нужными правами, наличие требований к очистке схем БД, отключение запланированного автообновления и диагностики записей БД в случае их модифицирующего характера. Также желательно привлечение специалистов разработки системы Заказчиком. Также БД наполняется копией БД с прода, прошедшей обезличивание данных."""

# Дефолтный текст принципов моделирования нагрузки (11.1)
DEFAULT_LOAD_MODELING_PRINCIPLES = """Нагрузочное тестирование требует разработки средств нагрузочного тестирования (СНТ). СНТ разрабатываются с использованием apache-jmeter-5.6.3 для создания и проведения тестов.

Моделирование нагрузки производится путем эмуляции действий определенного количества виртуальных пользователей (VU). Каждый VU циклически выполняет пользовательский сценарий.

Интенсивность выполнения сценария каждым VU зависит от сценария и задержки между двумя последовательными итерациями. Эти задержки критичны для создания реалистичной нагрузки.

Увеличение времени отклика системы в процессе тестирования компенсируется предустановленной задержкой, рассчитанной с запасом исходя из максимально допустимого времени отклика.

Если суммарное время отклика системы и время выполнения сценария не превышает задержку между двумя последовательными итерациями, то увеличение количества виртуальных пользователей приведет к пропорциональному увеличению общей интенсивности нагрузки.

В процессе тестирования общая интенсивность выполнения сценариев всеми виртуальными пользователями (моделируемая нагрузка на систему) регулируется изменением количества VU и задержки между последовательными итерациями (pacing).

Запуск профилей пользовательских операций и мониторинг ключевых показателей производительности для серверов-генераторов будет также выполняться с использованием apache-jmeter-5.6.3."""

# Дефолтный текст эмуляторов (11.4)
DEFAULT_EMULATORS_DESCRIPTION = """В текущем проекте взаимодействие со внешними системами не рассматривается."""

# Дефолтный текст мониторинга (12)
DEFAULT_MONITORING_INTRO = """Наличие метрик, перечисленных в данном разделе, является необходимым условием для успешного завершения нагрузочного тестирования (НТ). Метрики производительности должны собираться на тестовом стенде на протяжении всего времени тестирования. В случае отсутствия метрик тест не может считаться успешным."""

# Дефолтная таблица средств мониторинга (12.1)
DEFAULT_MONITORING_TOOLS_TABLE = """Наименование|Роль|Эндпоинт (URI)
Grafana|выступает в роли средства отображения метрик|
zabbix|выступает в роли средства отображения метрик|
kibana|выступает в роли базы данных для хранения временных рядов и в роли агента по сбору данных|"""

# Дефолтное примечание о мониторинге (12.1)
DEFAULT_MONITORING_TOOLS_NOTE = """В случае необходимости локализации узких мест в системе, будут проводиться дополнительные тестирования с рекомендуемыми метриками производительности в дополнение к базовым.

В случае выхода из строя основных средств мониторинга будут использоваться nmon, sar, iostat, vmstat.

Интервал сбора статистики по метрикам мониторинга составит 10 секунд.

Параметры производительности системы на стороне станций генерации нагрузки измеряются с помощью встроенных инструментов JMeter и инструментов мониторинга ОС Windows.

Все показатели фиксируются и анализируются для репрезентативных периодов выполнения теста:
• В периоды запланированных бизнес-операций (исключая периоды теста, когда происходит нарастание нагрузки).
• В периоды насыщения системы и деградации производительности, если таковые имеются."""

# Дефолтная таблица бизнес-метрик (12.2.2)
DEFAULT_BUSINESS_METRICS_TABLE = """Бизнес-метрика|Единица измерения
Интенсивность выполнения операций|RPS, оп/ч
Время отклика операций (максимальное)|с
Время отклика операций (минимальное)|с
Время отклика операций (среднее)|с
Время отклика операций (90% перцентиль)|с
Количество превышений времени отклика|
Количество успешных операций|оп/ч
Количество проваленных операций|оп/ч
Количество работающих VU|VU/с"""

# Дефолтные требования к Заказчику (13)
DEFAULT_CUSTOMER_REQUIREMENTS_INTRO = """Для обеспечения процесса выполнения работ по НТ системы Заказчика к нему предъявляется ряд требований:"""

DEFAULT_CUSTOMER_REQUIREMENTS_LIST = """1. Выполнить подготовку (сборку, настройку, установку системного ПО, развертывание тестируемых подсистем) тестового стенда для нагрузочного тестирования (отвечает Заказчик). Полное развертывание тестового стенда для нагрузочного тестирования должно быть произведено в сроки, указанные в календарном плане, согласованным с Заказчиком;
2. Предоставить выборки данных (статистики) по операциям Системы за пиковые часы работы в промышленной эксплуатации;
3. Спрогнозировать промышленную эксплуатацию при невозможности собрать статистику (например, когда система еще не введена в эксплуатацию);
4. Необходимо участие администраторов АС в мониторинге утилизации системных ресурсов и предоставление данных мониторинга для анализа результатов нагрузочного тестирования;
5. Необходимо участие специалистов Заказчика для консультации по вопросам интеграции с внешними системами и выполняемых в системе операций если таковы имеются;
6. Предоставить доступ к серверам генерации нагрузки, способных обеспечивать необходимую интенсивность выполнения операций;
7. Предоставить доступ к тестовому стенду с рабочего места Исполнителя;
8. Выполнить миграцию данных с промышленной БД в БД стенда нагрузочного тестирования;
9. Создать резервные копии тестовых БД перед началом проведения нагрузочных испытаний;
10. При необходимости, по запросу выполнить восстановление тестовой БД из резервной копии;
11. При необходимости, по запросу выполнить перезагрузку серверов, оперативно восстановить стенд после сбоев;
12. Обеспечить неизменность версии системы на протяжении тестирования в целях валидности результатов;
13. Исключить несогласованные изменения конфигурации тестового стенда на протяжении периода выполнения проекта по нагрузочному тестированию системы;
14. Обеспечить скорость подключения между узлами системы, генераторами нагрузки, эмуляторами и т.д., достаточной для проведения НТ;
15. Устранить блокеры НТ в случае их выявления. По необходимости доработать ППО силами Заказчика;"""

DEFAULT_CUSTOMER_REQUIREMENTS_NOTE_INTRO = """Если сроки доработки ППО приводят к тому, что проект не может быть завершен вовремя, то:"""

DEFAULT_CUSTOMER_REQUIREMENTS_NOTE_LIST = """1. В случае, если объём работ не меняется, стороны согласовывают изменение даты завершения работ без изменения общей трудоемкости;
2. В случае, если объём работ должен быть изменен, стороны согласовывают перечень и объем работ по тестированию после доработки ППО, вынесенных за рамки данного проекта в отдельный проект."""

# Дефолтная таблица материалов (14)
DEFAULT_DELIVERABLES_TABLE = """Документ|Подготавливается в результате деятельности
Методика тестирования|Планирование нагрузочного тестирования
Отчет по результатам нагрузочного тестирования|Проведение нагрузочного тестирования
Средства нагрузочного тестирования|Подготовка стенда и средств НТ
Рабочие документы (предоставляются только в электронном виде):|
Расчет интенсивности выполнения пользовательских сценариев|Подготовка методики НТ
Расчет нагрузочного сценария для инструмента НТ|Подготовка стенда и средств НТ
Результаты НТ|Документ предоставляется регулярно в процессе проведения НТ"""

# Дефолтная таблица контактов (15)
DEFAULT_CONTACTS_TABLE = """п/п|ФИО|Сфера ответственности|Контакты
1||Лидер Команды|
2||Заказчик тестирования|
3||Разработчики системы|"""

def get_default_mnt_data() -> dict:
    """Возвращает словарь с дефолтными значениями для нового МНТ"""
    return {
        "project_name": "УК «Первая»",
        "organization_name": "УК «Первая»",
        "system_version": "",
        "abbreviations_table": DEFAULT_ABBREVIATIONS,
        "terminology_table": DEFAULT_TERMINOLOGY,
        "introduction_text": DEFAULT_INTRODUCTION,
        "tasks_nt": DEFAULT_TASKS_NT,
        "limitations_list": DEFAULT_LIMITATIONS,
        "risks_table": DEFAULT_RISKS_TABLE,
        "object_general": DEFAULT_OBJECT_GENERAL,
        "test_stand_architecture_text": DEFAULT_TEST_STAND_ARCHITECTURE,
        "database_preparation_text": DEFAULT_DATABASE_PREPARATION,
        "load_modeling_principles": DEFAULT_LOAD_MODELING_PRINCIPLES,
        "emulators_description": DEFAULT_EMULATORS_DESCRIPTION,
        "monitoring_intro": DEFAULT_MONITORING_INTRO,
        "monitoring_tools_table": DEFAULT_MONITORING_TOOLS_TABLE,
        "monitoring_tools_note": DEFAULT_MONITORING_TOOLS_NOTE,
        "business_metrics_table": DEFAULT_BUSINESS_METRICS_TABLE,
        "customer_requirements_intro": DEFAULT_CUSTOMER_REQUIREMENTS_INTRO,
        "customer_requirements_list": DEFAULT_CUSTOMER_REQUIREMENTS_LIST,
        "customer_requirements_note_intro": DEFAULT_CUSTOMER_REQUIREMENTS_NOTE_INTRO,
        "customer_requirements_note_list": DEFAULT_CUSTOMER_REQUIREMENTS_NOTE_LIST,
        "deliverables_table": DEFAULT_DELIVERABLES_TABLE,
        "contacts_table": DEFAULT_CONTACTS_TABLE,
    }
