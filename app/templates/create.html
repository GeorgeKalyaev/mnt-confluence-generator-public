{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –ú–ù–¢ - –ú–ù–¢ Generator{% endblock %}

{% block navigation %}
<nav class="form-navigation">
    <h5>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h5>
    <div class="nav-container">
        <div class="nav-section">
            <a href="#section-header" class="nav-item">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</a>
        </div>
        <div class="nav-section">
            <a href="#section-1" class="nav-item">1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</a>
        </div>
        <div class="nav-section">
            <a href="#section-2" class="nav-item">2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</a>
        </div>
        <div class="nav-section">
            <a href="#section-3" class="nav-item">3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</a>
            <a href="#section-3-1" class="nav-item nav-subsection">3.1 –°–æ–∫—Ä–∞—â–µ–Ω–∏—è</a>
            <a href="#section-3-2" class="nav-item nav-subsection">3.2 –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</a>
        </div>
        <div class="nav-section">
            <a href="#section-4" class="nav-item">4. –í–≤–µ–¥–µ–Ω–∏–µ</a>
        </div>
        <div class="nav-section">
            <a href="#section-5" class="nav-item">5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</a>
            <a href="#section-5-1" class="nav-item nav-subsection">5.1 –¶–µ–ª–∏ –ù–¢</a>
            <a href="#section-5-2" class="nav-item nav-subsection">5.2 –ó–∞–¥–∞—á–∏ –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-6" class="nav-item">6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</a>
            <a href="#section-6-1" class="nav-item nav-subsection">6.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–¢</a>
            <a href="#section-6-2" class="nav-item nav-subsection">6.2 –†–∏—Å–∫–∏ –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-7" class="nav-item">7. –û–±—ä–µ–∫—Ç –ù–¢</a>
            <a href="#section-7-1" class="nav-item nav-subsection">7.1 –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</a>
            <a href="#section-7-2" class="nav-item nav-subsection">7.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</a>
            <a href="#section-7-3" class="nav-item nav-subsection">7.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</a>
        </div>
        <div class="nav-section">
            <a href="#section-8" class="nav-item">8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</a>
            <a href="#section-8-1" class="nav-item nav-subsection">8.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</a>
            <a href="#section-8-2" class="nav-item nav-subsection">8.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</a>
        </div>
        <div class="nav-section">
            <a href="#section-9" class="nav-item">9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</a>
            <a href="#section-9-1" class="nav-item nav-subsection">9.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</a>
            <a href="#section-9-2" class="nav-item nav-subsection">9.2 –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-10" class="nav-item">10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</a>
        </div>
        <div class="nav-section">
            <a href="#section-11" class="nav-item">11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</a>
            <a href="#section-11-1" class="nav-item nav-subsection">11.1 –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã</a>
            <a href="#section-11-2" class="nav-item nav-subsection">11.2 –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</a>
            <a href="#section-11-3" class="nav-item nav-subsection">11.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
            <a href="#section-11-4" class="nav-item nav-subsection">11.4 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</a>
        </div>
        <div class="nav-section">
            <a href="#section-12" class="nav-item">12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
            <a href="#section-12-1" class="nav-item nav-subsection">12.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</a>
            <a href="#section-12-2" class="nav-item nav-subsection">12.2 –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</a>
        </div>
        <div class="nav-section">
            <a href="#section-13" class="nav-item">13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</a>
        </div>
        <div class="nav-section">
            <a href="#section-14" class="nav-item">14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</a>
        </div>
        <div class="nav-section">
            <a href="#section-15" class="nav-item">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </div>
        <div class="nav-section">
            <a href="#section-tags" class="nav-item">–¢–µ–≥–∏</a>
        </div>
        <div class="nav-section">
            <a href="#section-confluence" class="nav-item">–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Confluence</a>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<h1 class="mb-4">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ú–ù–¢</h1>

{% if error_message %}
<div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
    <strong>‚ö† –û—à–∏–±–∫–∞:</strong> {{ error_message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}

<form method="post" action="/mnt/create" enctype="multipart/form-data">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div class="form-section" id="section-header">
        <h3>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="project_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="project_name" name="project_name" required 
                       value="{{ data.project_name if data else '' }}">
            </div>
            <div class="col-md-6 mb-3">
                <label for="organization_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="organization_name" name="organization_name" required 
                       value="{{ data.organization_name if data else '–£–ö ¬´–ü–µ—Ä–≤–∞—è¬ª' }}">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="system_version" class="form-label">–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="system_version" name="system_version" required 
                       value="{{ data.system_version if data else '' }}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1.0">
            </div>
            <div class="col-md-6 mb-3">
                <label for="author" class="form-label">–ê–≤—Ç–æ—Ä (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π) <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="author" name="author" required placeholder="–£–∫–∞–∂–∏—Ç–µ –§–ò–û –∞–≤—Ç–æ—Ä–∞ (–§–∞–º–∏–ª–∏—è –ò.–û.)">
            </div>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 1: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <div class="form-section" id="section-1">
        <h3>1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
        <div class="mb-3">
            <label class="form-label">–¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π</label>
            <small class="text-muted d-block mb-2">–î–∞—Ç–∞, –≤–µ—Ä—Å–∏—è –∏ –∞–≤—Ç–æ—Ä –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –£–∫–∞–∂–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="history_changes_table" name="history_changes_table">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º –ø–æ–ª–µ–º –æ–ø–∏—Å–∞–Ω–∏—è -->
            <div class="table-responsive">
                <table class="table table-bordered" id="history_changes_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 20%;">–î–∞—Ç–∞</th>
                            <th style="width: 10%;">–í–µ—Ä—Å–∏—è</th>
                            <th style="width: 50%;">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th style="width: 20%;">–ê–≤—Ç–æ—Ä</th>
                        </tr>
                    </thead>
                    <tbody id="history_changes_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <small class="text-muted d-block mt-1">–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ú–ù–¢ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å —Å –≤–µ—Ä—Å–∏–µ–π 0.1</small>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 2: –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è -->
    <div class="form-section" id="section-2">
        <h3>2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</h3>
        <div class="mb-3">
            <label for="approval_list_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</label>
            <small class="text-muted d-block mb-2">–ü–æ–ª—è –§–ò–û, –î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –î–∞—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ–¥–ø–∏—Å—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ. –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="approval_list_table" name="approval_list_table" value="">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="approval_list_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 22%;">–§–ò–û <span class="text-danger">*</span></th>
                            <th style="width: 22%;">–î–æ–ª–∂–Ω–æ—Å—Ç—å <span class="text-danger">*</span></th>
                            <th style="width: 22%;">–ü–æ–¥–ø–∏—Å—å</th>
                            <th style="width: 20%;">–î–∞—Ç–∞ <span class="text-danger">*</span></th>
                            <th style="width: 14%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="approval_list_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_approval_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 3: –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è -->
    <div class="form-section" id="section-3">
        <h3>3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</h3>
        
        <h4 class="mt-3 mb-3" id="section-3-1">3.1 –°–æ–∫—Ä–∞—â–µ–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="abbreviations_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="abbreviations_table" name="abbreviations_table" value="{{ data.abbreviations_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="abbreviations_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è <span class="text-danger">*</span></th>
                            <th style="width: 55%;">–û–ø–∏—Å–∞–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="abbreviations_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_abbreviation_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>

        <h4 class="mt-3 mb-3" id="section-3-2">3.2 –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</h4>
        <div class="mb-3">
            <label for="terminology_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="terminology_table" name="terminology_table" value="{{ data.terminology_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="terminology_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">–¢–µ—Ä–º–∏–Ω <span class="text-danger">*</span></th>
                            <th style="width: 55%;">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="terminology_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_terminology_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 4: –í–≤–µ–¥–µ–Ω–∏–µ -->
    <div class="form-section" id="section-4">
        <h3>4. –í–≤–µ–¥–µ–Ω–∏–µ</h3>
        <div class="mb-3">
            <label for="introduction_text" class="form-label">–¢–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω–∏—è</label>
            <textarea class="form-control" id="introduction_text" name="introduction_text" rows="10">{{ data.introduction_text if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 5: –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢ -->
    <div class="form-section" id="section-5">
        <h3>5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-5-1">5.1 –¶–µ–ª–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="goals_business" class="form-label">–ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏ (–∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="goals_business" name="goals_business" rows="5">{{ data.goals_business if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="goals_technical" class="form-label">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏ (–∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="goals_technical" name="goals_technical" rows="5">{{ data.goals_technical if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-5-2">5.2 –ó–∞–¥–∞—á–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="tasks_nt" class="form-label">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ù–¢ (–∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="tasks_nt" name="tasks_nt" rows="10">{{ data.tasks_nt if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 6: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢ -->
    <div class="form-section" id="section-6">
        <h3>6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-6-1">6.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–¢</h4>
        <div class="mb-3">
            <label for="limitations_list" class="form-label">–°–ø–∏—Å–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ù–¢ (–∫–∞–∂–¥–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="limitations_list" name="limitations_list" rows="15">{{ data.limitations_list if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-6-2">6.2 –†–∏—Å–∫–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="risks_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ –ù–¢</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="risks_table" name="risks_table" value="{{ data.risks_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="risks_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 50%;">–†–∏—Å–∫ <span class="text-danger">*</span></th>
                            <th style="width: 25%;">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è <span class="text-danger">*</span></th>
                            <th style="width: 20%;">–í–ª–∏—è–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="risks_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_risk_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 7: –û–±—ä–µ–∫—Ç –ù–¢ -->
    <div class="form-section" id="section-7">
        <h3>7. –û–±—ä–µ–∫—Ç –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-7-1">7.1 –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="object_general" class="form-label">–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ –ù–¢</label>
            <textarea class="form-control" id="object_general" name="object_general" rows="3">{{ data.object_general if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-7-2">7.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h4>
        <div class="mb-3">
            <label for="performance_requirements" class="form-label">–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="performance_requirements" name="performance_requirements" rows="6"></textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-7-3">7.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</h4>
        
        <h5 class="mt-2 mb-2">7.3.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
        <div class="mb-3">
            <label for="component_architecture_text" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="component_architecture_text" name="component_architecture_text" rows="6"></textarea>
        </div>
        <div class="mb-3">
            <label for="component_architecture_image_file" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–†–∏—Å—É–Ω–æ–∫ 1)</label>
            <input type="file" class="form-control" id="component_architecture_image_file" name="component_architecture_image_file" accept="image/*">
        </div>

        <h5 class="mt-3 mb-2">7.3.2 –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
        <div class="mb-3">
            <label for="information_architecture_image_file" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–†–∏—Å—É–Ω–æ–∫ 2)</label>
            <input type="file" class="form-control" id="information_architecture_image_file" name="information_architecture_image_file" accept="image/*">
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 8: –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã -->
    <div class="form-section" id="section-8">
        <h3>8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</h3>
        
        <h4 class="mt-3 mb-3" id="section-8-1">8.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</h4>
        <div class="mb-3">
            <label for="test_stand_architecture_text" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</label>
            <textarea class="form-control" id="test_stand_architecture_text" name="test_stand_architecture_text" rows="4">{{ data.test_stand_architecture_text if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-8-2">8.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã –∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</h4>
        <div class="mb-3">
            <label for="stand_comparison_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –°–∏—Å—Ç–µ–º–∞|–ü–∞—Ä–∞–º–µ—Ç—Ä|–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Ç—É—Ä–µ|–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="stand_comparison_table" name="stand_comparison_table" rows="10"></textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 9: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="form-section" id="section-9">
        <h3>9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        
        <h4 class="mt-3 mb-3" id="section-9-1">9.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</h4>
        <div class="mb-3">
            <label for="planned_tests_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="planned_tests_intro" name="planned_tests_intro" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="planned_tests_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: ‚Ññ|–¢–µ—Å—Ç|–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞|–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="planned_tests_table" name="planned_tests_table" rows="8"></textarea>
        </div>
        <div class="mb-3">
            <label for="planned_tests_note" class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã</label>
            <textarea class="form-control" id="planned_tests_note" name="planned_tests_note" rows="3"></textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-9-2">9.2 –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢</h4>
        <div class="mb-3">
            <label for="completion_conditions" class="form-label">–°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢ (–∫–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="completion_conditions" name="completion_conditions" rows="6"></textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 10: –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î -->
    <div class="form-section" id="section-10">
        <h3>10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</h3>
        <div class="mb-3">
            <label for="database_preparation_text" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î</label>
            <textarea class="form-control" id="database_preparation_text" name="database_preparation_text" rows="6">{{ data.database_preparation_text if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="database_preparation_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –æ–±—ä–µ–º–∞–º –¥–∞–Ω–Ω—ã—Ö</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –°—Ö–µ–º–∞.–¢–∞–±–ª–∏—Ü–∞|–¢–µ–∫—É—â–µ–µ –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ|–ü—Ä–æ–≥–Ω–æ–∑ —Ä–æ—Å—Ç–∞ –≤ –¥–µ–Ω—å (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="database_preparation_table" name="database_preparation_table" rows="8"></textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 11: –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="form-section" id="section-11">
        <h3>11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</h3>
        
        <h4 class="mt-3 mb-3" id="section-11-1">11.1 –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</h4>
        <div class="mb-3">
            <label for="load_modeling_principles" class="form-label">–¢–µ–∫—Å—Ç –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</label>
            <textarea class="form-control" id="load_modeling_principles" name="load_modeling_principles" rows="12">{{ data.load_modeling_principles if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-2">11.2 –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</h4>
        <div class="mb-3">
            <label for="load_profiles_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="load_profiles_intro" name="load_profiles_intro" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="load_profiles_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\–º–∏–Ω—É—Ç–∞ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="load_profiles_table" name="load_profiles_table" rows="8"></textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-3">11.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="use_scenarios_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="use_scenarios_intro" name="use_scenarios_intro" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="use_scenarios_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –®–∞–≥–∏|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\–º–∏–Ω—É—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞—è –∑–∞ 100% (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="use_scenarios_table" name="use_scenarios_table" rows="8"></textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-4">11.4 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</h4>
        <div class="mb-3">
            <label for="emulators_description" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</label>
            <textarea class="form-control" id="emulators_description" name="emulators_description" rows="4">{{ data.emulators_description if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 12: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ -->
    <div class="form-section" id="section-12">
        <h3>12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
        
        <div class="mb-3">
            <label for="monitoring_intro" class="form-label">–û–±—â–∏–π –≤–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="monitoring_intro" name="monitoring_intro" rows="4">{{ data.monitoring_intro if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-12-1">12.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
        <div class="mb-3">
            <label for="monitoring_tools_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="monitoring_tools_intro" name="monitoring_tools_intro" rows="2"></textarea>
        </div>
        <div class="mb-3">
            <label for="monitoring_tools_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ|–†–æ–ª—å|–≠–Ω–¥–ø–æ–∏–Ω—Ç (URI) (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="monitoring_tools_table" name="monitoring_tools_table" rows="8">{{ data.monitoring_tools_table if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="monitoring_tools_note" class="form-label">–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
            <textarea class="form-control" id="monitoring_tools_note" name="monitoring_tools_note" rows="8">{{ data.monitoring_tools_note if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-12-2">12.2 –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
        
        <h5 class="mt-2 mb-2">12.2.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</h5>
        <div class="mb-3">
            <label for="system_resources_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="system_resources_intro" name="system_resources_intro" rows="2"></textarea>
        </div>
        <div class="mb-3">
            <label for="system_resources_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: ‚Ññ|–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏|–°–ø–æ—Å–æ–± —Å–Ω—è—Ç–∏—è|–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è|–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="system_resources_table" name="system_resources_table" rows="8"></textarea>
        </div>

        <h5 class="mt-3 mb-2">12.2.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫</h5>
        <div class="mb-3">
            <label for="business_metrics_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="business_metrics_intro" name="business_metrics_intro" rows="2"></textarea>
        </div>
        <div class="mb-3">
            <label for="business_metrics_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∞|–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="business_metrics_table" name="business_metrics_table" rows="10">{{ data.business_metrics_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 13: –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É -->
    <div class="form-section" id="section-13">
        <h3>13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</h3>
        <div class="mb-3">
            <label for="customer_requirements_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="customer_requirements_intro" name="customer_requirements_intro" rows="3">{{ data.customer_requirements_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_list" class="form-label">–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–∫–∞–∂–¥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="customer_requirements_list" name="customer_requirements_list" rows="15">{{ data.customer_requirements_list if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_note_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
            <textarea class="form-control" id="customer_requirements_note_intro" name="customer_requirements_note_intro" rows="2">{{ data.customer_requirements_note_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_note_list" class="form-label">–°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ä–æ–∫–æ–≤ (–∫–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="customer_requirements_note_list" name="customer_requirements_note_list" rows="5">{{ data.customer_requirements_note_list if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 14: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ -->
    <div class="form-section" id="section-14">
        <h3>14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</h3>
        <div class="mb-3">
            <label for="deliverables_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="deliverables_intro" name="deliverables_intro" rows="2"></textarea>
        </div>
        <div class="mb-3">
            <label for="deliverables_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –î–æ–∫—É–º–µ–Ω—Ç|–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="deliverables_table" name="deliverables_table" rows="8">{{ data.deliverables_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 15: –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
    <div class="form-section" id="section-15">
        <h3>15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
        <div class="mb-3">
            <label for="contacts_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Ü</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ø/–ø|–§–ò–û|–°—Ñ–µ—Ä–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏|–ö–æ–Ω—Ç–∞–∫—Ç—ã (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="contacts_table" name="contacts_table" rows="6">{{ data.contacts_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- Confluence -->
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –±–ª–æ–∫–∏ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
    <div id="custom-sections-container"></div>
    
    <div class="form-section" id="section-add-custom">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫</h3>
        <div class="mb-3">
            <label for="custom_section_title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="custom_section_title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 16. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã">
        </div>
        <div class="mb-3">
            <label for="custom_section_insert_after" class="form-label">–í—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –±–ª–æ–∫–∞</label>
            <select class="form-select" id="custom_section_insert_after">
                <option value="15">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã (–≤ –∫–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞)</option>
                <option value="1">1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</option>
                <option value="2">2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</option>
                <option value="3">3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</option>
                <option value="4">4. –í–≤–µ–¥–µ–Ω–∏–µ</option>
                <option value="5">5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</option>
                <option value="6">6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</option>
                <option value="7">7. –û–±—ä–µ–∫—Ç –ù–¢</option>
                <option value="8">8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</option>
                <option value="9">9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</option>
                <option value="10">10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</option>
                <option value="11">11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</option>
                <option value="12">12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</option>
                <option value="13">13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</option>
                <option value="14">14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</option>
                <option value="15">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</option>
            </select>
        </div>
        <button type="button" class="btn btn-primary" id="add-custom-section-btn">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
    </div>
    -->
    
    <!-- –¢–µ–≥–∏ -->
    <div class="form-section" id="section-tags">
        <h3>–¢–µ–≥–∏</h3>
        <div class="mb-3">
            <label for="tags" class="form-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            <input type="text" 
                   class="form-control" 
                   id="tags" 
                   name="tags" 
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ—Ç—Ä–µ–π–¥, –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å"
                   value="">
            <small class="form-text text-muted">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ—Ç—Ä–µ–π–¥, –ö–æ–º–∞–Ω–¥–∞ –ê, –ü—Ä–æ–µ–∫—Ç –ë</small>
        </div>
    </div>

    <!-- Confluence -->
    <div class="form-section" id="section-confluence">
        <h3>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Confluence</h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="confluence_space" class="form-label">Space Key <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="confluence_space" name="confluence_space" required 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: TEST" value="{{ data.confluence_space if data else 'TEST' }}">
                <small class="form-text text-muted">
                    –ö–ª—é—á –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (Space) –≤ Confluence, –≥–¥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–ù–¢. 
                    –≠—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–æ–±—ã—á–Ω–æ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ).
                    <br><strong>–ö–∞–∫ –Ω–∞–π—Ç–∏ Space Key:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ Confluence –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ URL ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>spaceKey=TEST</code> –∏–ª–∏ –ø—É—Ç—å <code>/spaces/TEST/</code>
                </small>
            </div>
            <div class="col-md-6 mb-3">
                <label for="confluence_parent_id" class="form-label">Parent Page ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="number" class="form-control" id="confluence_parent_id" name="confluence_parent_id" 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456" value="{{ data.confluence_parent_id if data else '' }}">
                <small class="form-text text-muted">
                    ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Confluence, –ø–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–ù–¢ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü). 
                    –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.
                    <br><strong>–ö–∞–∫ –Ω–∞–π—Ç–∏ ID:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Confluence –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ URL ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>pageId=123456</code>
                </small>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è -->
    <input type="hidden" name="publish" id="publish_hidden" value="">
    
    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="d-flex gap-2 mb-4">
        <button type="submit" class="btn btn-primary" onclick="document.getElementById('publish_hidden').value='1';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Confluence</button>
        <button type="submit" class="btn btn-secondary" onclick="document.getElementById('publish_hidden').value='';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</button>
        <button type="button" class="btn btn-outline-info" id="preview-btn">üëÅÔ∏è –ü—Ä–µ–≤—å—é</button>
        <a href="/mnt/list" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="/static/js/table-editor.js"></script>
<script src="/static/js/form-validation.js"></script>
<script src="/static/js/image-preview.js"></script>
<script>
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –≤–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö
document.addEventListener('DOMContentLoaded', function() {
    const authorInput = document.getElementById('author');
    const historyTableHidden = document.getElementById('history_changes_table');
    const historyTableTbody = document.getElementById('history_changes_tbody');
    
    if (!authorInput || !historyTableTbody || !historyTableHidden) {
        return;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateHiddenField() {
        if (!historyTableTbody || !historyTableHidden) return;
        
        const rows = historyTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            historyTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–î–∞—Ç–∞|–í–µ—Ä—Å–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ|–ê–≤—Ç–æ—Ä'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 4) {
                const date = cells[0].textContent.trim();
                const version = cells[1].textContent.trim();
                const descInput = cells[2].querySelector('input[name="history_description"]');
                const description = descInput ? descInput.value.trim() : cells[2].textContent.trim();
                const author = cells[3].textContent.trim();
                parts.push(`${date}|${version}|${description}|${author}`);
            }
        });
        
        historyTableHidden.value = parts.join('\n');
    }
    
    function updateHistoryTable() {
        if (!historyTableTbody || !historyTableHidden || !authorInput) return;
        
        const author = authorInput.value.trim();
        
        if (!author) {
            // –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω, –æ—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            historyTableTbody.innerHTML = '';
            historyTableHidden.value = '';
            return;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
        const today = new Date();
        const day = String(today.getDate()).padStart(2, '0');
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const year = today.getFullYear();
        const dateStr = `${day}.${month}.${year}`;
        
        // –ü–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ input (–µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ)
        let description = '–ó–∞–ø–æ–ª–Ω–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã';
        const existingInput = historyTableTbody.querySelector('input[name="history_description"]');
        if (existingInput && existingInput.value.trim()) {
            description = existingInput.value.trim();
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã
        historyTableTbody.innerHTML = `
            <tr>
                <td>${dateStr}</td>
                <td>0.1</td>
                <td>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           name="history_description" 
                           value="${description}"
                           placeholder="–ó–∞–ø–æ–ª–Ω–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã">
                </td>
                <td>${author}</td>
            </tr>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –ü–ï–†–ï–î –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è
        const newDescriptionInput = historyTableTbody.querySelector('input[name="history_description"]');
        if (newDescriptionInput) {
            newDescriptionInput.addEventListener('input', function() {
                updateHiddenField();
            });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
        updateHiddenField();
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–≤—Ç–æ—Ä–∞
    authorInput.addEventListener('input', function() {
        updateHistoryTable();
    });
    authorInput.addEventListener('change', function() {
        updateHistoryTable();
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä —É–∂–µ –µ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞)
    setTimeout(function() {
        if (authorInput.value.trim()) {
            updateHistoryTable();
        }
    }, 100);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/create"]');
    if (form) {
        form.addEventListener('submit', function(e) {
            updateHiddenField();
        });
    }
});
</script>

<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π
document.addEventListener('DOMContentLoaded', function() {
    const abbreviationsTableHidden = document.getElementById('abbreviations_table');
    const abbreviationsTableTbody = document.getElementById('abbreviations_tbody');
    const addAbbreviationRowBtn = document.getElementById('add_abbreviation_row_btn');
    
    if (!abbreviationsTableHidden || !abbreviationsTableTbody) {
        console.error('Abbreviations table elements not found');
        return;
    }
    
    console.log('Abbreviations table script loaded, button:', addAbbreviationRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createAbbreviationRow(rowData = { name: '', description: '' }) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm abbreviation-name" 
                       name="abbreviation_name[]" 
                       value="${rowData.name || ''}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–ù–¢"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm abbreviation-description" 
                       name="abbreviation_description[]" 
                       value="${rowData.description || ''}"
                       placeholder="–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-abbreviation-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingAbbreviationData() {
        const abbreviationData = abbreviationsTableHidden.value.trim();
        
        if (!abbreviationData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = abbreviationData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    name: parts[0] || '',
                    description: parts[1] || ''
                };
                const row = createAbbreviationRow(rowData);
                abbreviationsTableTbody.appendChild(row);
            }
        }
        
        updateAbbreviationHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateAbbreviationHiddenField() {
        const rows = abbreviationsTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            abbreviationsTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const nameInput = row.querySelector('.abbreviation-name');
            const descriptionInput = row.querySelector('.abbreviation-description');
            
            if (nameInput && descriptionInput) {
                const name = nameInput.value.trim();
                const description = descriptionInput.value.trim();
                if (name || description) {
                    parts.push(`${name}|${description}`);
                }
            }
        });
        
        abbreviationsTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addAbbreviationRowBtn) {
        console.log('Adding click handler to abbreviation row button');
        addAbbreviationRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add abbreviation row button clicked');
            const newRow = createAbbreviationRow();
            abbreviationsTableTbody.appendChild(newRow);
            updateAbbreviationHiddenField();
        });
    } else {
        console.error('Add abbreviation row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    abbreviationsTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-abbreviation-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateAbbreviationHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    abbreviationsTableTbody.addEventListener('input', function() {
        updateAbbreviationHiddenField();
    });
    
    abbreviationsTableTbody.addEventListener('change', function() {
        updateAbbreviationHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingAbbreviationData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateAbbreviationHiddenField();
        });
    }
});
</script>

<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    const terminologyTableHidden = document.getElementById('terminology_table');
    const terminologyTableTbody = document.getElementById('terminology_tbody');
    const addTerminologyRowBtn = document.getElementById('add_terminology_row_btn');
    
    if (!terminologyTableHidden || !terminologyTableTbody) {
        console.error('Terminology table elements not found');
        return;
    }
    
    console.log('Terminology table script loaded, button:', addTerminologyRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createTerminologyRow(rowData = { term: '', definition: '' }) {
        const row = document.createElement('tr');
        const termValue = (rowData.term || '').replace(/"/g, '&quot;');
        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏
        let definitionValue = (rowData.definition || '').replace(/\[IMAGE:[^\]]+\]/g, '').trim();
        definitionValue = definitionValue.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm terminology-term" 
                       name="terminology_term[]" 
                       value="${termValue}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
                       required>
            </td>
            <td>
                <textarea class="form-control form-control-sm terminology-definition" 
                       name="terminology_definition[]" 
                       rows="3"
                       placeholder="–ü—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π"
                       required>${definitionValue}</textarea>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-terminology-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingTerminologyData() {
        const terminologyData = terminologyTableHidden.value.trim();
        
        if (!terminologyData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = terminologyData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    term: parts[0] || '',
                    definition: parts[1] || ''
                };
                const row = createTerminologyRow(rowData);
                terminologyTableTbody.appendChild(row);
            }
        }
        
        updateTerminologyHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateTerminologyHiddenField() {
        const rows = terminologyTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            terminologyTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–¢–µ—Ä–º–∏–Ω|–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const termInput = row.querySelector('.terminology-term');
            const definitionInput = row.querySelector('.terminology-definition');
            
            if (termInput && definitionInput) {
                const term = termInput.value.trim();
                const definition = definitionInput.value.trim();
                
                if (term || definition) {
                    parts.push(`${term}|${definition}`);
                }
            }
        });
        
        terminologyTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addTerminologyRowBtn) {
        console.log('Adding click handler to terminology row button');
        addTerminologyRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add terminology row button clicked');
            const newRow = createTerminologyRow();
            terminologyTableTbody.appendChild(newRow);
            updateTerminologyHiddenField();
        });
    } else {
        console.error('Add terminology row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    terminologyTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-terminology-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateTerminologyHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    terminologyTableTbody.addEventListener('input', function() {
        updateTerminologyHiddenField();
    });
    
    terminologyTableTbody.addEventListener('change', function() {
        updateTerminologyHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingTerminologyData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateTerminologyHiddenField();
        });
    }
});
</script>

<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–∏—Å–∫–æ–≤ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Ä–∏—Å–∫–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const risksTableHidden = document.getElementById('risks_table');
    const risksTableTbody = document.getElementById('risks_tbody');
    const addRiskRowBtn = document.getElementById('add_risk_row_btn');
    
    if (!risksTableHidden || !risksTableTbody) {
        console.error('Risks table elements not found');
        return;
    }
    
    console.log('Risks table script loaded, button:', addRiskRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createRiskRow(rowData = { risk: '', probability: '', impact: '' }) {
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm risk-risk" 
                       name="risk_risk[]" 
                       value="${(rowData.risk || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –°–ù–¢ –≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm risk-probability" 
                       name="risk_probability[]" 
                       value="${(rowData.probability || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ä–µ–¥–Ω—è—è"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm risk-impact" 
                       name="risk_impact[]" 
                       value="${(rowData.impact || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ä–æ–∫–∏ –ù–¢"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-risk-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingRiskData() {
        const risksData = risksTableHidden.value.trim();
        
        if (!risksData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = risksData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 3) {
                const rowData = {
                    risk: parts[0] || '',
                    probability: parts[1] || '',
                    impact: parts[2] || ''
                };
                const row = createRiskRow(rowData);
                risksTableTbody.appendChild(row);
            }
        }
        
        updateRiskHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateRiskHiddenField() {
        const rows = risksTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            risksTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–†–∏—Å–∫|–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è|–í–ª–∏—è–Ω–∏–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const riskInput = row.querySelector('.risk-risk');
            const probabilityInput = row.querySelector('.risk-probability');
            const impactInput = row.querySelector('.risk-impact');
            
            if (riskInput && probabilityInput && impactInput) {
                const risk = riskInput.value.trim();
                const probability = probabilityInput.value.trim();
                const impact = impactInput.value.trim();
                if (risk || probability || impact) {
                    parts.push(`${risk}|${probability}|${impact}`);
                }
            }
        });
        
        risksTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addRiskRowBtn) {
        console.log('Adding click handler to risk row button');
        addRiskRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add risk row button clicked');
            const newRow = createRiskRow();
            risksTableTbody.appendChild(newRow);
            updateRiskHiddenField();
        });
    } else {
        console.error('Add risk row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    risksTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-risk-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateRiskHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    risksTableTbody.addEventListener('input', function() {
        updateRiskHiddenField();
    });
    
    risksTableTbody.addEventListener('change', function() {
        updateRiskHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingRiskData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateRiskHiddenField();
        });
    }
});
</script>

<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const approvalTableHidden = document.getElementById('approval_list_table');
    const approvalTableTbody = document.getElementById('approval_list_tbody');
    const addApprovalRowBtn = document.getElementById('add_approval_row_btn');
    
    if (!approvalTableHidden || !approvalTableTbody) {
        console.error('Approval table elements not found');
        return;
    }
    
    console.log('Approval table script loaded, button:', addApprovalRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç DD.MM.YYYY
    function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}.${month}.${year}`;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD –¥–ª—è input[type="date"]
    function formatDateForInput(date) {
        if (!date) {
            const today = new Date();
            return today.toISOString().split('T')[0]; // YYYY-MM-DD
        }
        // –ï—Å–ª–∏ –¥–∞—Ç–∞ —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
        if (date.match(/^\d{4}-\d{2}-\d{2}$/)) {
            return date;
        }
        // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ YYYY-MM-DD
        if (date.match(/^\d{2}\.\d{2}\.\d{4}$/)) {
            const [day, month, year] = date.split('.');
            return `${year}-${month}-${day}`;
        }
        // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç Date, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º
        if (date instanceof Date) {
            return date.toISOString().split('T')[0];
        }
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        return new Date().toISOString().split('T')[0];
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createApprovalRow(rowData = { fio: '', position: '', signature: '', date: null }) {
        const row = document.createElement('tr');
        const dateValue = formatDateForInput(rowData.date);
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm approval-fio" 
                       name="approval_fio[]" 
                       value="${rowData.fio || ''}"
                       placeholder="–§–∞–º–∏–ª–∏—è –ò.–û."
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm approval-position" 
                       name="approval_position[]" 
                       value="${rowData.position || ''}"
                       placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm approval-signature" 
                       name="approval_signature[]" 
                       value="${rowData.signature || ''}"
                       placeholder="–ü–æ–¥–ø–∏—Å—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
            </td>
            <td>
                <input type="date" 
                       class="form-control form-control-sm approval-date" 
                       name="approval_date[]" 
                       value="${dateValue}"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-approval-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingApprovalData() {
        const approvalData = approvalTableHidden.value.trim();
        
        if (!approvalData) {
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const defaultRow = createApprovalRow();
            approvalTableTbody.appendChild(defaultRow);
            updateApprovalHiddenField();
            return;
        }
        
        const lines = approvalData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ - –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
            const defaultRow = createApprovalRow();
            approvalTableTbody.appendChild(defaultRow);
            updateApprovalHiddenField();
            return;
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 4) {
                const rowData = {
                    fio: parts[0] || '',
                    position: parts[1] || '',
                    signature: parts[2] || '',
                    date: parts[3] || null // formatDateForInput –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç null –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                };
                const row = createApprovalRow(rowData);
                approvalTableTbody.appendChild(row);
            }
        }
        
        updateApprovalHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateApprovalHiddenField() {
        const rows = approvalTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            approvalTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–§–ò–û|–î–æ–ª–∂–Ω–æ—Å—Ç—å|–ü–æ–¥–ø–∏—Å—å|–î–∞—Ç–∞'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const fioInput = row.querySelector('.approval-fio');
            const positionInput = row.querySelector('.approval-position');
            const signatureInput = row.querySelector('.approval-signature');
            const dateInput = row.querySelector('.approval-date');
            
            if (fioInput && positionInput && signatureInput && dateInput) {
                const fio = fioInput.value.trim();
                const position = positionInput.value.trim();
                const signature = signatureInput.value.trim();
                let date = dateInput.value.trim();
                
                // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ DD.MM.YYYY
                if (date && date.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    const [year, month, day] = date.split('-');
                    date = `${day}.${month}.${year}`;
                }
                
                parts.push(`${fio}|${position}|${signature}|${date}`);
            }
        });
        
        approvalTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addApprovalRowBtn) {
        console.log('Adding click handler to approval row button');
        addApprovalRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add approval row button clicked');
            const newRow = createApprovalRow();
            approvalTableTbody.appendChild(newRow);
            updateApprovalHiddenField();
        });
    } else {
        console.error('Add approval row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    approvalTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-approval-row')) {
            const row = e.target.closest('tr');
            if (row) {
                // –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É
                if (approvalTableTbody.querySelectorAll('tr').length > 1) {
                    row.remove();
                    updateApprovalHiddenField();
                } else {
                    alert('–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ');
                }
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    approvalTableTbody.addEventListener('input', function() {
        updateApprovalHiddenField();
    });
    
    approvalTableTbody.addEventListener('change', function() {
        updateApprovalHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingApprovalData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateApprovalHiddenField();
        });
    }
});
</script>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ —Ç–∞–±–ª–∏—Ü –∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã —Ç–∞–±–ª–∏—Ü
    // history_changes_table - –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è, –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    // approval_list_table - –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏
    const tableFields = [
        // 'approval_list_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'abbreviations_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'terminology_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'risks_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        'stand_comparison_table',
        'planned_tests_table',
        'database_preparation_table',
        'load_profiles_table',
        'use_scenarios_table',
        'monitoring_tools_table',
        'system_resources_table',
        'business_metrics_table',
        'deliverables_table',
        'contacts_table'
    ];
    
    tableFields.forEach(fieldId => {
        if (document.getElementById(fieldId)) {
            new TableEditor(fieldId);
        }
    });
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –ø–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ–∫–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã)
    document.querySelectorAll('.form-navigation .nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault(); // –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
            const href = this.getAttribute('href');
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —è–∫–æ—Ä—è (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #)
            if (href && href.startsWith('#')) {
                const targetId = href.substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —É—á–µ—Ç–æ–º offset –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - 80; // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É
                    
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞
                    document.querySelectorAll('.form-navigation .nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    history.pushState(null, null, href);
                } else {
                    console.warn(`–≠–ª–µ–º–µ–Ω—Ç —Å id="${targetId}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                }
            }
            // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (–Ω–µ —è–∫–æ—Ä–µ–π) –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º - –ø—É—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ
        });
    });
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
    const sections = document.querySelectorAll('.form-section[id]');
    const navItems = document.querySelectorAll('.form-navigation .nav-item[href^="#"]');
    
    function updateActiveNav() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (window.pageYOffset >= sectionTop - 150) {
                current = section.getAttribute('id');
            }
        });
        
        navItems.forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('href') === '#' + current) {
                item.classList.add('active');
            }
        });
    }
    
    window.addEventListener('scroll', updateActiveNav);
    updateActiveNav();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
    /*
    let customSectionCounter = 0;
    const customSectionsContainer = document.getElementById('custom-sections-container');
    const addCustomSectionBtn = document.getElementById('add-custom-section-btn');
    
    if (addCustomSectionBtn && customSectionsContainer) {
        addCustomSectionBtn.addEventListener('click', function() {
            const title = document.getElementById('custom_section_title').value.trim();
            const insertAfter = parseInt(document.getElementById('custom_section_insert_after').value);
            
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞');
                return;
            }
            
            customSectionCounter++;
            const sectionId = `custom-section-${customSectionCounter}`;
            const timestamp = Date.now();
            
            // –°–æ–∑–¥–∞–µ–º HTML –±–ª–æ–∫–∞
            const sectionHtml = `
                <div class="form-section custom-section" id="${sectionId}" data-section-id="${timestamp}" data-position="${insertAfter}">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3>${title}</h3>
                        <button type="button" class="btn btn-sm btn-danger remove-custom-section" data-section-id="${timestamp}">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    
                    <input type="hidden" name="custom_sections[${timestamp}][id]" value="${timestamp}">
                    <input type="hidden" name="custom_sections[${timestamp}][title]" value="${title.replace(/"/g, '&quot;')}">
                    <input type="hidden" name="custom_sections[${timestamp}][position]" value="${insertAfter}">
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–µ–∫—Å—Ç</label>
                        <textarea class="form-control" name="custom_sections[${timestamp}][text]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–∞–±–ª–∏—Ü–∞</label>
                        <textarea class="form-control" id="custom_table_${timestamp}" name="custom_sections[${timestamp}][table]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É"></textarea>
                        <small class="text-muted">–§–æ—Ä–º–∞—Ç: –ó–∞–≥–æ–ª–æ–≤–æ–∫1|–ó–∞–≥–æ–ª–æ–≤–æ–∫2, –î–∞–Ω–Ω—ã–µ1|–î–∞–Ω–Ω—ã–µ2</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–°–ø–∏—Å–æ–∫ (–∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
                        <textarea class="form-control" name="custom_sections[${timestamp}][list]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞"></textarea>
                    </div>
                </div>
            `;
            
            customSectionsContainer.insertAdjacentHTML('beforeend', sectionHtml);
            
            if (typeof TableEditor !== 'undefined') {
                const tableEditorId = `custom_table_${timestamp}`;
                setTimeout(() => {
                    const tableField = document.getElementById(tableEditorId);
                    if (tableField) {
                        new TableEditor(tableEditorId);
                    }
                }, 100);
            }
            
            addToNavigation(sectionId, title);
            document.getElementById('custom_section_title').value = '';
            updateActiveNav();
        });
        
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-custom-section')) {
                const sectionId = e.target.getAttribute('data-section-id');
                const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                if (section && confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫?')) {
                    const navItem = document.querySelector(`[data-nav-custom="${sectionId}"]`);
                    if (navItem) navItem.remove();
                    section.remove();
                }
            }
        });
        
        function addToNavigation(sectionId, title) {
            const navContainer = document.querySelector('.form-navigation .nav-container');
            if (!navContainer) return;
            
            const navItem = document.createElement('div');
            navItem.className = 'nav-section';
            navItem.setAttribute('data-nav-custom', sectionId);
            navItem.innerHTML = `<a href="#${sectionId}" class="nav-item">${title}</a>`;
            
            const publishNav = Array.from(navContainer.children).find(el => 
                el.querySelector('a[href="#section-confluence"]')
            );
            
            if (publishNav) {
                navContainer.insertBefore(navItem, publishNav);
            } else {
                navContainer.appendChild(navItem);
            }
        }
    }
    */
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤ –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    const formForTags = document.querySelector('form[action*="/mnt/create"]');
    if (formForTags) {
        // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Ç–µ–≥–æ–≤
        let hiddenInput = document.getElementById('tags_hidden');
        if (!hiddenInput) {
            hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.id = 'tags_hidden';
            hiddenInput.name = 'tags';
            formForTags.appendChild(hiddenInput);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤ —Ç–µ–≥–æ–≤
        const tagCheckboxes = document.querySelectorAll('.tag-checkbox');
        tagCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const selectedTags = Array.from(document.querySelectorAll('.tag-checkbox:checked'))
                    .map(cb => cb.value)
                    .join(',');
                hiddenInput.value = selectedTags;
            });
        });
    }
    
    // –ü—Ä–µ–≤—å—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    const previewBtn = document.getElementById('preview-btn');
    if (previewBtn) {
        previewBtn.addEventListener('click', function() {
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const formForPreview = document.querySelector('form[action*="/mnt/"]');
            if (!formForPreview) return;
    
            const formData = new FormData(formForPreview);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (key !== 'publish') {
                    data[key] = value;
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–µ–≤—å—é
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'previewModal';
            modal.innerHTML = `
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ü—Ä–µ–≤—å—é –ú–ù–¢</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="preview-content">
                        <h1>–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
                        <h2>${data.project_name || '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞'}</h2>
                        <p><strong>–£–ö ¬´–ü–µ—Ä–≤–∞—è¬ª</strong></p>
                        <p>–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: ${data.system_version || ''}</p>
                        <hr>
                        <p><em>–≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–µ–≤—å—é. –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Confluence.</em></p>
                        <p><strong>–ê–≤—Ç–æ—Ä:</strong> ${data.author || ''}</p>
                        <p><strong>Space Key:</strong> ${data.confluence_space || ''}</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    `;
    
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            // –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
            modal.addEventListener('hidden.bs.modal', function() {
                modal.remove();
            });
        });
    }
}); // –∫–æ–Ω–µ—Ü DOMContentLoaded
</script>
{% endblock %}
