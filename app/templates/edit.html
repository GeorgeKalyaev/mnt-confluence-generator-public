{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ú–ù–¢ - –ú–ù–¢ Generator{% endblock %}

{% block navigation %}
<nav class="form-navigation">
    <h5>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h5>
    <div class="nav-container">
        <div class="nav-section">
            <a href="#section-header" class="nav-item">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</a>
        </div>
        <div class="nav-section">
            <a href="#section-1" class="nav-item">1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</a>
        </div>
        <div class="nav-section">
            <a href="#section-2" class="nav-item">2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</a>
        </div>
        <div class="nav-section">
            <a href="#section-3" class="nav-item">3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</a>
            <a href="#section-3-1" class="nav-item nav-subsection">3.1 –°–æ–∫—Ä–∞—â–µ–Ω–∏—è</a>
            <a href="#section-3-2" class="nav-item nav-subsection">3.2 –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</a>
        </div>
        <div class="nav-section">
            <a href="#section-4" class="nav-item">4. –í–≤–µ–¥–µ–Ω–∏–µ</a>
        </div>
        <div class="nav-section">
            <a href="#section-5" class="nav-item">5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</a>
            <a href="#section-5-1" class="nav-item nav-subsection">5.1 –¶–µ–ª–∏ –ù–¢</a>
            <a href="#section-5-2" class="nav-item nav-subsection">5.2 –ó–∞–¥–∞—á–∏ –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-6" class="nav-item">6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</a>
            <a href="#section-6-1" class="nav-item nav-subsection">6.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–¢</a>
            <a href="#section-6-2" class="nav-item nav-subsection">6.2 –†–∏—Å–∫–∏ –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-7" class="nav-item">7. –û–±—ä–µ–∫—Ç –ù–¢</a>
            <a href="#section-7-1" class="nav-item nav-subsection">7.1 –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</a>
            <a href="#section-7-2" class="nav-item nav-subsection">7.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</a>
            <a href="#section-7-3" class="nav-item nav-subsection">7.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</a>
        </div>
        <div class="nav-section">
            <a href="#section-8" class="nav-item">8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</a>
            <a href="#section-8-1" class="nav-item nav-subsection">8.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</a>
            <a href="#section-8-2" class="nav-item nav-subsection">8.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</a>
        </div>
        <div class="nav-section">
            <a href="#section-9" class="nav-item">9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</a>
            <a href="#section-9-1" class="nav-item nav-subsection">9.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</a>
            <a href="#section-9-2" class="nav-item nav-subsection">9.2 –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-10" class="nav-item">10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</a>
        </div>
        <div class="nav-section">
            <a href="#section-11" class="nav-item">11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</a>
            <a href="#section-11-1" class="nav-item nav-subsection">11.1 –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã</a>
            <a href="#section-11-2" class="nav-item nav-subsection">11.2 –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</a>
            <a href="#section-11-3" class="nav-item nav-subsection">11.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
            <a href="#section-11-4" class="nav-item nav-subsection">11.4 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</a>
        </div>
        <div class="nav-section">
            <a href="#section-12" class="nav-item">12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
            <a href="#section-12-1" class="nav-item nav-subsection">12.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</a>
            <a href="#section-12-2" class="nav-item nav-subsection">12.2 –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</a>
        </div>
        <div class="nav-section">
            <a href="#section-13" class="nav-item">13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</a>
        </div>
        <div class="nav-section">
            <a href="#section-14" class="nav-item">14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</a>
        </div>
        <div class="nav-section">
            <a href="#section-15" class="nav-item">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </div>
        <div class="nav-section">
            <a href="#section-confluence" class="nav-item">–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Confluence</a>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<h1 class="mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ú–ù–¢: {{ document.title }}</h1>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–∞—Ö -->
{% set success_param = success_message or request.query_params.get('success') %}
{% if success_param %}
<div class="alert alert-success alert-dismissible fade show" role="alert">
    {% if success_param == 'updated' %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ú–ù–¢ –æ–±–Ω–æ–≤–ª–µ–Ω.
    {% elif success_param == 'updated_published' %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ú–ù–¢ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ Confluence.
    {% elif success_param == 'restored' %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ú–ù–¢ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã. {% if document.confluence_page_id %}–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ Confluence –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞.{% endif %}
    {% else %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> {{ success_param }}
    {% endif %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% set error_param = error_message or request.query_params.get('error') %}
{% if error_param %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>‚úó –û—à–∏–±–∫–∞!</strong> {{ error_param }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% set warning_param = warning_message or request.query_params.get('warning') %}
{% if warning_param %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:</strong> 
    {% if warning_param == 'confluence_failed' %}
    –ú–ù–¢ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Confluence. –í—ã –º–æ–∂–µ—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –µ–≥–æ –∑–∞–Ω–æ–≤–æ.
    {% else %}
    {{ warning_param }}
    {% endif %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% if document.last_error and not error_param %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:</strong> {{ document.last_error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{# –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö #}
{% if document.status == 'published' and document.confluence_page_id %}
    {% if document.last_publish_at and document.updated_at and document.updated_at > document.last_publish_at %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–æ—Ç –ú–ù–¢ –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ Confluence, –Ω–æ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±—ã–ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã. 
        –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –≤ Confluence –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –≤–µ—Ä—Å–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
        <br><small class="text-muted">
            –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: {{ document.last_publish_at.strftime('%d.%m.%Y %H:%M') }} | 
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ document.updated_at.strftime('%d.%m.%Y %H:%M') }}
        </small>
        
        {% if unpublished_changes and unpublished_changes|length > 0 %}
        <div class="mt-3">
            <button class="btn btn-sm btn-outline-info" type="button" data-bs-toggle="collapse" data-bs-target="#unpublished-changes-list" aria-expanded="false" aria-controls="unpublished-changes-list">
                üìù –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π ({{ unpublished_changes|length }})
            </button>
            <small class="text-muted ms-2">–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –≤ —Ñ–æ—Ä–º–µ –Ω–∏–∂–µ</small>
            <div class="collapse mt-2" id="unpublished-changes-list">
                <div class="card card-body bg-light" style="max-height: 400px; overflow-y: auto;">
                    <small>
                        <strong>–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è:</strong>
                        <ul class="mb-0 mt-2">
                            {% for change in unpublished_changes %}
                            <li class="mb-2">
                                <strong>{{ change.field_name or change.field }}:</strong>
                                {% if change.type == 'added' %}
                                    <span class="text-success">+ –î–æ–±–∞–≤–ª–µ–Ω–æ</span>
                                    {% if change.new and change.new is string and change.new|length < 100 %}
                                        <br><span class="text-muted">{{ change.new }}</span>
                                    {% elif change.new and change.new is iterable and change.new is not string %}
                                        <span class="text-muted">({{ change.new|length }} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</span>
                                    {% endif %}
                                {% elif change.type == 'removed' %}
                                    <span class="text-danger">- –£–¥–∞–ª–µ–Ω–æ</span>
                                    {% if change.old and change.old is string and change.old|length < 100 %}
                                        <br><span class="text-muted text-decoration-line-through">{{ change.old }}</span>
                                    {% elif change.old and change.old is iterable and change.old is not string %}
                                        <span class="text-muted">({{ change.old|length }} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</span>
                                    {% endif %}
                                {% elif change.type == 'changed' %}
                                    <span class="text-primary">~ –ò–∑–º–µ–Ω–µ–Ω–æ</span>
                                    {% if change.old and change.old is string %}
                                        <br><span class="text-danger text-decoration-line-through">–ë—ã–ª–æ: {{ change.old[:80] }}{% if change.old|length > 80 %}...{% endif %}</span>
                                    {% endif %}
                                    {% if change.new and change.new is string %}
                                        <br><span class="text-success">–°—Ç–∞–ª–æ: {{ change.new[:80] }}{% if change.new|length > 80 %}...{% endif %}</span>
                                    {% elif change.new and change.new is iterable and change.new is not string %}
                                        <br><span class="text-muted">({{ change.new|length }} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</span>
                                    {% endif %}
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </small>
                </div>
            </div>
        </div>
        {% endif %}
        
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% elif document.updated_at and not document.last_publish_at %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–æ—Ç –ú–ù–¢ –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ Confluence, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –µ—Å—Ç—å –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
{% endif %}

{% if document.confluence_page_url %}
<div class="alert alert-info">
    <strong>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ Confluence:</strong> <a href="{{ document.confluence_page_url }}" target="_blank">{{ document.confluence_page_url }}</a>
</div>
{% endif %}

{% if existing_attachments %}
<div class="form-section">
    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è –≤ Confluence</h3>
    <div class="table-responsive">
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–†–∞–∑–º–µ—Ä</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for attachment in existing_attachments %}
                <tr>
                    <td>{{ attachment.filename }}</td>
                    <td>{{ attachment.mediaType }}</td>
                    <td>{{ attachment.fileSize }} bytes</td>
                    <td>
                        <a href="/mnt/{{ document.id }}/attachment/{{ attachment.id }}/delete" 
                           class="btn btn-sm btn-danger" 
                           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–ª–æ–∂–µ–Ω–∏–µ?')">
                            –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<form method="post" action="/mnt/{{ document.id }}/edit" enctype="multipart/form-data">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div class="form-section" id="section-header">
        <h3>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="project_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="project_name" name="project_name" required 
                       value="{{ data.project_name if data else document.title }}">
            </div>
            <div class="col-md-6 mb-3">
                <label for="organization_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="organization_name" name="organization_name" required 
                       value="{{ data.organization_name if data else '' }}">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="system_version" class="form-label">–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="system_version" name="system_version" required 
                       value="{{ data.system_version if data else '' }}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1.0">
            </div>
            <div class="col-md-6 mb-3">
                <label for="author" class="form-label">–ê–≤—Ç–æ—Ä (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π) <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="author" name="author" required 
                       value="{{ document.author }}">
            </div>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 1: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <div class="form-section" id="section-1">
        <h3>1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
        <div class="mb-3">
            <label for="history_changes_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –î–∞—Ç–∞|–í–µ—Ä—Å–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ|–ê–≤—Ç–æ—Ä (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="history_changes_table" name="history_changes_table" rows="6">{{ data.history_changes_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 2: –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è -->
    <div class="form-section" id="section-2">
        <h3>2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</h3>
        <div class="mb-3">
            <label for="approval_list_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –§–ò–û|–î–æ–ª–∂–Ω–æ—Å—Ç—å|–ü–æ–¥–ø–∏—Å—å|–î–∞—Ç–∞ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="approval_list_table" name="approval_list_table" rows="5">{{ data.approval_list_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 3: –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è -->
    <div class="form-section" id="section-3">
        <h3>3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</h3>
        
        <h4 class="mt-3 mb-3" id="section-3-1">3.1 –°–æ–∫—Ä–∞—â–µ–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="abbreviations_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="abbreviations_table" name="abbreviations_table" rows="15">{{ data.abbreviations_table if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-3-2">3.2 –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</h4>
        <div class="mb-3">
            <label for="terminology_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –¢–µ—Ä–º–∏–Ω|–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="terminology_table" name="terminology_table" rows="15">{{ data.terminology_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 4: –í–≤–µ–¥–µ–Ω–∏–µ -->
    <div class="form-section" id="section-4">
        <h3>4. –í–≤–µ–¥–µ–Ω–∏–µ</h3>
        <div class="mb-3">
            <label for="introduction_text" class="form-label">–¢–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω–∏—è</label>
            <textarea class="form-control" id="introduction_text" name="introduction_text" rows="10">{{ data.introduction_text if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 5: –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢ -->
    <div class="form-section" id="section-5">
        <h3>5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-5-1">5.1 –¶–µ–ª–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="goals_business" class="form-label">–ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏ (–∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="goals_business" name="goals_business" rows="5">{{ data.goals_business if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="goals_technical" class="form-label">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏ (–∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="goals_technical" name="goals_technical" rows="5">{{ data.goals_technical if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-5-2">5.2 –ó–∞–¥–∞—á–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="tasks_nt" class="form-label">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ù–¢ (–∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="tasks_nt" name="tasks_nt" rows="10">{{ data.tasks_nt if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 6: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢ -->
    <div class="form-section" id="section-6">
        <h3>6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-6-1">6.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–¢</h4>
        <div class="mb-3">
            <label for="limitations_list" class="form-label">–°–ø–∏—Å–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ù–¢ (–∫–∞–∂–¥–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="limitations_list" name="limitations_list" rows="15">{{ data.limitations_list if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-6-2">6.2 –†–∏—Å–∫–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="risks_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ –ù–¢</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –†–∏—Å–∫|–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è|–í–ª–∏—è–Ω–∏–µ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="risks_table" name="risks_table" rows="15">{{ data.risks_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 7: –û–±—ä–µ–∫—Ç –ù–¢ -->
    <div class="form-section" id="section-7">
        <h3>7. –û–±—ä–µ–∫—Ç –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-7-1">7.1 –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="object_general" class="form-label">–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ –ù–¢</label>
            <textarea class="form-control" id="object_general" name="object_general" rows="3">{{ data.object_general if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-7-2">7.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h4>
        <div class="mb-3">
            <label for="performance_requirements" class="form-label">–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="performance_requirements" name="performance_requirements" rows="6">{{ data.performance_requirements if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-7-3">7.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</h4>
        
        <h5 class="mt-2 mb-2">7.3.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
        <div class="mb-3">
            <label for="component_architecture_text" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="component_architecture_text" name="component_architecture_text" rows="6">{{ data.component_architecture_text if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="component_architecture_image_file" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–†–∏—Å—É–Ω–æ–∫ 1) - –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ</label>
            <input type="file" class="form-control" id="component_architecture_image_file" name="component_architecture_image_file" accept="image/*">
            <small class="text-muted">–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ–Ω–æ –∑–∞–º–µ–Ω–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ</small>
        </div>

        <h5 class="mt-3 mb-2">7.3.2 –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
        <div class="mb-3">
            <label for="information_architecture_image_file" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–†–∏—Å—É–Ω–æ–∫ 2) - –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ</label>
            <input type="file" class="form-control" id="information_architecture_image_file" name="information_architecture_image_file" accept="image/*">
            <small class="text-muted">–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ–Ω–æ –∑–∞–º–µ–Ω–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ</small>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 8: –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã -->
    <div class="form-section" id="section-8">
        <h3>8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</h3>
        
        <h4 class="mt-3 mb-3" id="section-8-1">8.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</h4>
        <div class="mb-3">
            <label for="test_stand_architecture_text" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</label>
            <textarea class="form-control" id="test_stand_architecture_text" name="test_stand_architecture_text" rows="4">{{ data.test_stand_architecture_text if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-8-2">8.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã –∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</h4>
        <div class="mb-3">
            <label for="stand_comparison_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –°–∏—Å—Ç–µ–º–∞|–ü–∞—Ä–∞–º–µ—Ç—Ä|–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Ç—É—Ä–µ|–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="stand_comparison_table" name="stand_comparison_table" rows="10">{{ data.stand_comparison_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 9: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="form-section" id="section-9">
        <h3>9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        
        <h4 class="mt-3 mb-3" id="section-9-1">9.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</h4>
        <div class="mb-3">
            <label for="planned_tests_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="planned_tests_intro" name="planned_tests_intro" rows="3">{{ data.planned_tests_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="planned_tests_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: ‚Ññ|–¢–µ—Å—Ç|–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞|–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="planned_tests_table" name="planned_tests_table" rows="8">{{ data.planned_tests_table if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="planned_tests_note" class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã</label>
            <textarea class="form-control" id="planned_tests_note" name="planned_tests_note" rows="3">{{ data.planned_tests_note if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-9-2">9.2 –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢</h4>
        <div class="mb-3">
            <label for="completion_conditions" class="form-label">–°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢ (–∫–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="completion_conditions" name="completion_conditions" rows="6">{{ data.completion_conditions if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 10: –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î -->
    <div class="form-section" id="section-10">
        <h3>10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</h3>
        <div class="mb-3">
            <label for="database_preparation_text" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î</label>
            <textarea class="form-control" id="database_preparation_text" name="database_preparation_text" rows="6">{{ data.database_preparation_text if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="database_preparation_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –æ–±—ä–µ–º–∞–º –¥–∞–Ω–Ω—ã—Ö</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –°—Ö–µ–º–∞.–¢–∞–±–ª–∏—Ü–∞|–¢–µ–∫—É—â–µ–µ –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ|–ü—Ä–æ–≥–Ω–æ–∑ —Ä–æ—Å—Ç–∞ –≤ –¥–µ–Ω—å (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="database_preparation_table" name="database_preparation_table" rows="8">{{ data.database_preparation_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 11: –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="form-section" id="section-11">
        <h3>11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</h3>
        
        <h4 class="mt-3 mb-3" id="section-11-1">11.1 –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</h4>
        <div class="mb-3">
            <label for="load_modeling_principles" class="form-label">–¢–µ–∫—Å—Ç –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</label>
            <textarea class="form-control" id="load_modeling_principles" name="load_modeling_principles" rows="12">{{ data.load_modeling_principles if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-2">11.2 –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</h4>
        <div class="mb-3">
            <label for="load_profiles_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="load_profiles_intro" name="load_profiles_intro" rows="3">{{ data.load_profiles_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="load_profiles_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\–º–∏–Ω—É—Ç–∞ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="load_profiles_table" name="load_profiles_table" rows="8">{{ data.load_profiles_table if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-3">11.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="use_scenarios_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="use_scenarios_intro" name="use_scenarios_intro" rows="3">{{ data.use_scenarios_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="use_scenarios_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –®–∞–≥–∏|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\–º–∏–Ω—É—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞—è –∑–∞ 100% (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="use_scenarios_table" name="use_scenarios_table" rows="8">{{ data.use_scenarios_table if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-4">11.4 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</h4>
        <div class="mb-3">
            <label for="emulators_description" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</label>
            <textarea class="form-control" id="emulators_description" name="emulators_description" rows="4">{{ data.emulators_description if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 12: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ -->
    <div class="form-section" id="section-12">
        <h3>12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
        
        <div class="mb-3">
            <label for="monitoring_intro" class="form-label">–û–±—â–∏–π –≤–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="monitoring_intro" name="monitoring_intro" rows="4">{{ data.monitoring_intro if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-12-1">12.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
        <div class="mb-3">
            <label for="monitoring_tools_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="monitoring_tools_intro" name="monitoring_tools_intro" rows="2">{{ data.monitoring_tools_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="monitoring_tools_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ|–†–æ–ª—å|–≠–Ω–¥–ø–æ–∏–Ω—Ç (URI) (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="monitoring_tools_table" name="monitoring_tools_table" rows="8">{{ data.monitoring_tools_table if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="monitoring_tools_note" class="form-label">–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
            <textarea class="form-control" id="monitoring_tools_note" name="monitoring_tools_note" rows="8">{{ data.monitoring_tools_note if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-12-2">12.2 –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
        
        <h5 class="mt-2 mb-2">12.2.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</h5>
        <div class="mb-3">
            <label for="system_resources_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="system_resources_intro" name="system_resources_intro" rows="2">{{ data.system_resources_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="system_resources_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: ‚Ññ|–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏|–°–ø–æ—Å–æ–± —Å–Ω—è—Ç–∏—è|–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è|–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="system_resources_table" name="system_resources_table" rows="8">{{ data.system_resources_table if data else '' }}</textarea>
        </div>

        <h5 class="mt-3 mb-2">12.2.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫</h5>
        <div class="mb-3">
            <label for="business_metrics_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="business_metrics_intro" name="business_metrics_intro" rows="2">{{ data.business_metrics_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="business_metrics_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∞|–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="business_metrics_table" name="business_metrics_table" rows="10">{{ data.business_metrics_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 13: –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É -->
    <div class="form-section" id="section-13">
        <h3>13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</h3>
        <div class="mb-3">
            <label for="customer_requirements_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="customer_requirements_intro" name="customer_requirements_intro" rows="3">{{ data.customer_requirements_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_list" class="form-label">–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–∫–∞–∂–¥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="customer_requirements_list" name="customer_requirements_list" rows="15">{{ data.customer_requirements_list if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_note_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
            <textarea class="form-control" id="customer_requirements_note_intro" name="customer_requirements_note_intro" rows="2">{{ data.customer_requirements_note_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_note_list" class="form-label">–°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ä–æ–∫–æ–≤ (–∫–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="customer_requirements_note_list" name="customer_requirements_note_list" rows="5">{{ data.customer_requirements_note_list if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 14: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ -->
    <div class="form-section" id="section-14">
        <h3>14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</h3>
        <div class="mb-3">
            <label for="deliverables_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="deliverables_intro" name="deliverables_intro" rows="2">{{ data.deliverables_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="deliverables_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –î–æ–∫—É–º–µ–Ω—Ç|–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="deliverables_table" name="deliverables_table" rows="8">{{ data.deliverables_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 15: –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
    <div class="form-section" id="section-15">
        <h3>15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
        <div class="mb-3">
            <label for="contacts_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Ü</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ø/–ø|–§–ò–û|–°—Ñ–µ—Ä–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏|–ö–æ–Ω—Ç–∞–∫—Ç—ã (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="contacts_table" name="contacts_table" rows="6">{{ data.contacts_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –±–ª–æ–∫–∏ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
    <div id="custom-sections-container"></div>
    
    <div class="form-section" id="section-add-custom">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫</h3>
        <div class="mb-3">
            <label for="custom_section_title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="custom_section_title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 16. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã">
        </div>
        <div class="mb-3">
            <label for="custom_section_insert_after" class="form-label">–í—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –±–ª–æ–∫–∞</label>
            <select class="form-select" id="custom_section_insert_after">
                <option value="15">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã (–≤ –∫–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞)</option>
                <option value="1">1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</option>
                <option value="2">2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</option>
                <option value="3">3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</option>
                <option value="4">4. –í–≤–µ–¥–µ–Ω–∏–µ</option>
                <option value="5">5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</option>
                <option value="6">6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</option>
                <option value="7">7. –û–±—ä–µ–∫—Ç –ù–¢</option>
                <option value="8">8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</option>
                <option value="9">9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</option>
                <option value="10">10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</option>
                <option value="11">11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</option>
                <option value="12">12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</option>
                <option value="13">13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</option>
                <option value="14">14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</option>
                <option value="15">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</option>
            </select>
        </div>
        <button type="button" class="btn btn-primary" id="add-custom-section-btn">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
    </div>
    -->

    <!-- –¢–µ–≥–∏ -->
    <div class="form-section" id="section-tags">
        <h3>–¢–µ–≥–∏</h3>
        <div class="mb-3">
            <label for="tags" class="form-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            {% set existing_tags = data.tags if data and data.tags else [] %}
            <input type="text" 
                   class="form-control" 
                   id="tags" 
                   name="tags" 
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ—Ç—Ä–µ–π–¥, –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å"
                   value="{{ existing_tags|join(', ') if existing_tags else '' }}">
            <small class="form-text text-muted">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ—Ç—Ä–µ–π–¥, –ö–æ–º–∞–Ω–¥–∞ –ê, –ü—Ä–æ–µ–∫—Ç –ë</small>
        </div>
    </div>

    <!-- Confluence -->
    <div class="form-section" id="section-confluence">
        <h3>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Confluence</h3>
        
        {% if document.last_error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>‚ö† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong><br>
            <small>{{ document.last_error }}</small>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="confluence_space" class="form-label">Space Key <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="confluence_space" name="confluence_space" required 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: TEST" value="{{ document.confluence_space or '' }}">
                <small class="form-text text-muted">
                    –ö–ª—é—á –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (Space) –≤ Confluence, –≥–¥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–ù–¢. 
                    –≠—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–æ–±—ã—á–Ω–æ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ).
                    <br><strong>–ö–∞–∫ –Ω–∞–π—Ç–∏ Space Key:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ Confluence –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ URL ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>spaceKey=TEST</code> –∏–ª–∏ –ø—É—Ç—å <code>/spaces/TEST/</code>
                </small>
            </div>
            <div class="col-md-6 mb-3">
                <label for="confluence_parent_id" class="form-label">Parent Page ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="number" class="form-control" id="confluence_parent_id" name="confluence_parent_id" 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456" value="{{ document.confluence_parent_id or '' }}">
                <small class="form-text text-muted">
                    ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Confluence, –ø–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–ù–¢ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü). 
                    –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.
                    <br><strong>–ö–∞–∫ –Ω–∞–π—Ç–∏ ID:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Confluence –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ URL ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>pageId=123456</code>
                </small>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è -->
    <input type="hidden" name="publish" id="publish_hidden" value="">
    
    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="d-flex gap-2 mb-4">
        <button type="submit" class="btn btn-primary" onclick="document.getElementById('publish_hidden').value='1';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤ Confluence</button>
        <button type="submit" class="btn btn-secondary" onclick="document.getElementById('publish_hidden').value='';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å (–±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏)</button>
        <a href="/mnt/{{ document.id }}/preview" target="_blank" class="btn btn-outline-info">üëÅÔ∏è –ü—Ä–µ–≤—å—é</a>
        <a href="/mnt/{{ document.id }}/versions" class="btn btn-outline-secondary">üìö –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π</a>
        <div class="btn-group">
            <button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/mnt/{{ document.id }}/export/html">–≠–∫—Å–ø–æ—Ä—Ç –≤ HTML</a></li>
                <li><a class="dropdown-item" href="/mnt/{{ document.id }}/export/txt">–≠–∫—Å–ø–æ—Ä—Ç –≤ TXT</a></li>
            </ul>
        </div>
        <a href="/mnt/list" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="/static/js/table-editor.js"></script>
<script src="/static/js/form-validation.js"></script>
<script src="/static/js/auto-save.js"></script>
<script src="/static/js/image-preview.js"></script>
<script src="/static/js/unsaved-changes.js"></script>
{% if unpublished_changes and unpublished_changes|length > 0 %}
<script id="unpublished-changes-data" type="application/json">{{ unpublished_changes|tojson|safe }}</script>
<script src="/static/js/highlight-changes.js"></script>
<script>
// –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
console.log('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: unpublished_changes –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ —à–∞–±–ª–æ–Ω:', {{ unpublished_changes|length }});
</script>
{% else %}
<script>
console.log('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: unpublished_changes –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –ø—É—Å—Ç—ã');
console.log('unpublished_changes:', {{ unpublished_changes|tojson|safe if unpublished_changes else 'null' }});
</script>
{% endif %}
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–æ–ª–µ–π, –≥–¥–µ —ç—Ç–æ –Ω—É–∂–Ω–æ
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã —Ç–∞–±–ª–∏—Ü
    const tableFields = [
        'history_changes_table',
        'approval_list_table',
        'abbreviations_table',
        'terminology_table',
        'risks_table',
        'stand_comparison_table',
        'planned_tests_table',
        'database_preparation_table',
        'load_profiles_table',
        'use_scenarios_table',
        'monitoring_tools_table',
        'system_resources_table',
        'business_metrics_table',
        'deliverables_table',
        'contacts_table'
    ];
    
    tableFields.forEach(fieldId => {
        if (document.getElementById(fieldId)) {
            new TableEditor(fieldId);
        }
    });
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –ø–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ–∫–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã)
    document.querySelectorAll('.form-navigation .nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault(); // –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
            const href = this.getAttribute('href');
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —è–∫–æ—Ä—è (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #)
            if (href && href.startsWith('#')) {
                const targetId = href.substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —É—á–µ—Ç–æ–º offset –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - 80; // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É
                    
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞
                    document.querySelectorAll('.form-navigation .nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    history.pushState(null, null, href);
                } else {
                    console.warn(`–≠–ª–µ–º–µ–Ω—Ç —Å id="${targetId}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                }
            }
            // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (–Ω–µ —è–∫–æ—Ä–µ–π) –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º - –ø—É—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ
        });
    });
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
    const sections = document.querySelectorAll('.form-section[id]');
    const navItems = document.querySelectorAll('.form-navigation .nav-item[href^="#"]');
    
    function updateActiveNav() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (window.pageYOffset >= sectionTop - 150) {
                current = section.getAttribute('id');
            }
        });
        
        navItems.forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('href') === '#' + current) {
                item.classList.add('active');
            }
        });
    }
    
    window.addEventListener('scroll', updateActiveNav);
    updateActiveNav();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
    /*
    let customSectionCounter = 0;
    const customSectionsContainer = document.getElementById('custom-sections-container');
    const addCustomSectionBtn = document.getElementById('add-custom-section-btn');
    
    function loadExistingCustomSections() {
        {% if data and data.custom_sections %}
        const customSections = {{ data.custom_sections | tojson }};
        customSections.forEach(function(section) {
            const sectionId = section.id || `custom-${Date.now()}`;
            const sectionHtml = createCustomSectionHTML(sectionId, section);
            customSectionsContainer.insertAdjacentHTML('beforeend', sectionHtml);
            
            const tableFieldId = `custom_table_${sectionId}`;
            if (typeof TableEditor !== 'undefined') {
                setTimeout(() => {
                    const tableField = document.getElementById(tableFieldId);
                    if (tableField) {
                        new TableEditor(tableFieldId);
                    }
                }, 100);
            }
            
            addToNavigation(`custom-section-${sectionId}`, section.title || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫');
        });
        {% endif %}
    }
    
    function createCustomSectionHTML(sectionId, sectionData) {
        const title = sectionData.title || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫';
        const position = sectionData.position || 15;
        const text = sectionData.text || '';
        const table = sectionData.table || '';
        const list = sectionData.list || '';
        const uniqueId = sectionData.id || sectionId || `custom-${Date.now()}`;
        
        return `
            <div class="form-section custom-section" id="custom-section-${uniqueId}" data-section-id="${uniqueId}" data-position="${position}">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>${title.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</h3>
                    <button type="button" class="btn btn-sm btn-danger remove-custom-section" data-section-id="${uniqueId}">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
                
                <input type="hidden" name="custom_sections[${uniqueId}][id]" value="${uniqueId}">
                <input type="hidden" name="custom_sections[${uniqueId}][title]" value="${title.replace(/"/g, '&quot;')}">
                <input type="hidden" name="custom_sections[${uniqueId}][position]" value="${position}">
                
                <div class="mb-3">
                    <label class="form-label">–¢–µ–∫—Å—Ç</label>
                    <textarea class="form-control" name="custom_sections[${uniqueId}][text]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞">${text.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">–¢–∞–±–ª–∏—Ü–∞</label>
                    <textarea class="form-control" id="custom_table_${uniqueId}" name="custom_sections[${uniqueId}][table]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É">${table.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    <small class="text-muted">–§–æ—Ä–º–∞—Ç: –ó–∞–≥–æ–ª–æ–≤–æ–∫1|–ó–∞–≥–æ–ª–æ–≤–æ–∫2, –î–∞–Ω–Ω—ã–µ1|–î–∞–Ω–Ω—ã–µ2</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">–°–ø–∏—Å–æ–∫ (–∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
                    <textarea class="form-control" name="custom_sections[${uniqueId}][list]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞">${list.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                </div>
            </div>
        `;
    }
    
    if (addCustomSectionBtn && customSectionsContainer) {
        loadExistingCustomSections();
        
        addCustomSectionBtn.addEventListener('click', function() {
            const title = document.getElementById('custom_section_title').value.trim();
            const insertAfter = parseInt(document.getElementById('custom_section_insert_after').value);
            
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞');
                return;
            }
            
            customSectionCounter++;
            const sectionId = `custom-section-${customSectionCounter}`;
            const timestamp = Date.now();
            
            const sectionData = {
                id: timestamp,
                title: title,
                position: insertAfter,
                text: '',
                table: '',
                list: ''
            };
            
            const sectionHtml = createCustomSectionHTML(timestamp, sectionData);
            customSectionsContainer.insertAdjacentHTML('beforeend', sectionHtml);
            
            if (typeof TableEditor !== 'undefined') {
                const tableEditorId = `custom_table_${timestamp}`;
                setTimeout(() => {
                    const tableField = document.getElementById(tableEditorId);
                    if (tableField) {
                        new TableEditor(tableEditorId);
                    }
                }, 100);
            }
            
            addToNavigation(sectionId, title);
            document.getElementById('custom_section_title').value = '';
            updateActiveNav();
        });
        
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-custom-section')) {
                const sectionId = e.target.getAttribute('data-section-id');
                const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                if (section && confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫?')) {
                    const navItem = document.querySelector(`[data-nav-custom="custom-section-${sectionId}"]`);
                    if (navItem) navItem.remove();
                    section.remove();
                }
            }
        });
        
        function addToNavigation(sectionId, title) {
            const navContainer = document.querySelector('.form-navigation .nav-container');
            if (!navContainer) return;
            
            const navItem = document.createElement('div');
            navItem.className = 'nav-section';
            navItem.setAttribute('data-nav-custom', sectionId);
            navItem.innerHTML = `<a href="#${sectionId}" class="nav-item">${title.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</a>`;
            
            const publishNav = Array.from(navContainer.children).find(el => 
                el.querySelector('a[href="#section-confluence"]')
            );
            
            if (publishNav) {
                navContainer.insertBefore(navItem, publishNav);
            } else {
                navContainer.appendChild(navItem);
            }
        }
    }
    */
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞
document.addEventListener('DOMContentLoaded', function() {
    const createTagForm = document.getElementById('createTagForm');
    if (createTagForm) {
        createTagForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/api/tags', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    const modal = bootstrap.Modal.getInstance(document.getElementById('createTagModal'));
                    if (modal) modal.hide();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∞
                    location.reload();
                } else {
                    const errorData = await response.json();
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞: ' + (errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞: ' + error.message);
            }
        });
    }
});

</script>
{% endblock %}
