{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ú–ù–¢ - –ú–ù–¢ Generator{% endblock %}

{% block navigation %}
<nav class="form-navigation">
    <h5>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h5>
    <div class="nav-container">
        <div class="nav-section">
            <a href="#section-header" class="nav-item">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</a>
        </div>
        <div class="nav-section">
            <a href="#section-1" class="nav-item">1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</a>
        </div>
        <div class="nav-section">
            <a href="#section-2" class="nav-item">2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</a>
        </div>
        <div class="nav-section">
            <a href="#section-3" class="nav-item">3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</a>
            <a href="#section-3-1" class="nav-item nav-subsection">3.1 –°–æ–∫—Ä–∞—â–µ–Ω–∏—è</a>
            <a href="#section-3-2" class="nav-item nav-subsection">3.2 –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</a>
        </div>
        <div class="nav-section">
            <a href="#section-4" class="nav-item">4. –í–≤–µ–¥–µ–Ω–∏–µ</a>
        </div>
        <div class="nav-section">
            <a href="#section-5" class="nav-item">5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</a>
            <a href="#section-5-1" class="nav-item nav-subsection">5.1 –¶–µ–ª–∏ –ù–¢</a>
            <a href="#section-5-2" class="nav-item nav-subsection">5.2 –ó–∞–¥–∞—á–∏ –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-6" class="nav-item">6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</a>
            <a href="#section-6-1" class="nav-item nav-subsection">6.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–¢</a>
            <a href="#section-6-2" class="nav-item nav-subsection">6.2 –†–∏—Å–∫–∏ –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-7" class="nav-item">7. –û–±—ä–µ–∫—Ç –ù–¢</a>
            <a href="#section-7-1" class="nav-item nav-subsection">7.1 –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</a>
            <a href="#section-7-2" class="nav-item nav-subsection">7.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</a>
            <a href="#section-7-3" class="nav-item nav-subsection">7.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</a>
        </div>
        <div class="nav-section">
            <a href="#section-8" class="nav-item">8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</a>
            <a href="#section-8-1" class="nav-item nav-subsection">8.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</a>
            <a href="#section-8-2" class="nav-item nav-subsection">8.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</a>
        </div>
        <div class="nav-section">
            <a href="#section-9" class="nav-item">9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</a>
            <a href="#section-9-1" class="nav-item nav-subsection">9.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</a>
            <a href="#section-9-2" class="nav-item nav-subsection">9.2 –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢</a>
        </div>
        <div class="nav-section">
            <a href="#section-10" class="nav-item">10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</a>
        </div>
        <div class="nav-section">
            <a href="#section-11" class="nav-item">11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</a>
            <a href="#section-11-1" class="nav-item nav-subsection">11.1 –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã</a>
            <a href="#section-11-2" class="nav-item nav-subsection">11.2 –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</a>
            <a href="#section-11-3" class="nav-item nav-subsection">11.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
            <a href="#section-11-4" class="nav-item nav-subsection">11.4 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</a>
        </div>
        <div class="nav-section">
            <a href="#section-12" class="nav-item">12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
            <a href="#section-12-1" class="nav-item nav-subsection">12.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</a>
            <a href="#section-12-2" class="nav-item nav-subsection">12.2 –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</a>
        </div>
        <div class="nav-section">
            <a href="#section-13" class="nav-item">13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</a>
        </div>
        <div class="nav-section">
            <a href="#section-14" class="nav-item">14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</a>
        </div>
        <div class="nav-section">
            <a href="#section-15" class="nav-item">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </div>
        <div class="nav-section">
            <a href="#section-confluence" class="nav-item">–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Confluence</a>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<h1 class="mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ú–ù–¢: {{ document.title }}</h1>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–∞—Ö -->
{% set success_param = success_message or request.query_params.get('success') %}
{% if success_param %}
<div class="alert alert-success alert-dismissible fade show" role="alert">
    {% if success_param == 'updated' %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ú–ù–¢ –æ–±–Ω–æ–≤–ª–µ–Ω.
    {% elif success_param == 'updated_published' %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ú–ù–¢ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ Confluence.
    {% elif success_param == 'restored' %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ú–ù–¢ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã. {% if document.confluence_page_id %}–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ Confluence –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞.{% endif %}
    {% else %}
    <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> {{ success_param }}
    {% endif %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% set error_param = error_message or request.query_params.get('error') %}
{% if error_param %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>‚úó –û—à–∏–±–∫–∞!</strong> {{ error_param }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% set warning_param = warning_message or request.query_params.get('warning') %}
{% if warning_param %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:</strong> 
    {% if warning_param == 'confluence_failed' %}
    –ú–ù–¢ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Confluence. –í—ã –º–æ–∂–µ—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –µ–≥–æ –∑–∞–Ω–æ–≤–æ.
    {% else %}
    {{ warning_param }}
    {% endif %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% if document.last_error and not error_param %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:</strong> {{ document.last_error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{# –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö #}
{% if document.status == 'published' and document.confluence_page_id %}
    {% if document.last_publish_at and document.updated_at and document.updated_at > document.last_publish_at %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–æ—Ç –ú–ù–¢ –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ Confluence, –Ω–æ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±—ã–ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã. 
        –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –≤ Confluence –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –≤–µ—Ä—Å–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
        <br><small class="text-muted">
            –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: {{ document.last_publish_at.strftime('%d.%m.%Y %H:%M') }} | 
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ document.updated_at.strftime('%d.%m.%Y %H:%M') }}
        </small>
        
        {% if unpublished_changes and unpublished_changes|length > 0 %}
        <div class="mt-3">
            <button class="btn btn-sm btn-outline-info" type="button" data-bs-toggle="collapse" data-bs-target="#unpublished-changes-list" aria-expanded="false" aria-controls="unpublished-changes-list">
                üìù –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π ({{ unpublished_changes|length }})
            </button>
            <small class="text-muted ms-2">–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –≤ —Ñ–æ—Ä–º–µ –Ω–∏–∂–µ</small>
            <div class="collapse mt-2" id="unpublished-changes-list">
                <div class="card card-body bg-light" style="max-height: 400px; overflow-y: auto;">
                    <small>
                        <strong>–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è:</strong>
                        <ul class="mb-0 mt-2">
                            {% for change in unpublished_changes %}
                            <li class="mb-2">
                                <strong>{{ change.field_name or change.field }}:</strong>
                                {% if change.type == 'added' %}
                                    <span class="text-success">+ –î–æ–±–∞–≤–ª–µ–Ω–æ</span>
                                    {% if change.new and change.new is string and change.new|length < 100 %}
                                        <br><span class="text-muted">{{ change.new }}</span>
                                    {% elif change.new and change.new is iterable and change.new is not string %}
                                        <span class="text-muted">({{ change.new|length }} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</span>
                                    {% endif %}
                                {% elif change.type == 'removed' %}
                                    <span class="text-danger">- –£–¥–∞–ª–µ–Ω–æ</span>
                                    {% if change.old and change.old is string and change.old|length < 100 %}
                                        <br><span class="text-muted text-decoration-line-through">{{ change.old }}</span>
                                    {% elif change.old and change.old is iterable and change.old is not string %}
                                        <span class="text-muted">({{ change.old|length }} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</span>
                                    {% endif %}
                                {% elif change.type == 'changed' %}
                                    <span class="text-primary">~ –ò–∑–º–µ–Ω–µ–Ω–æ</span>
                                    {% if change.old and change.old is string %}
                                        <br><span class="text-danger text-decoration-line-through">–ë—ã–ª–æ: {{ change.old[:80] }}{% if change.old|length > 80 %}...{% endif %}</span>
                                    {% endif %}
                                    {% if change.new and change.new is string %}
                                        <br><span class="text-success">–°—Ç–∞–ª–æ: {{ change.new[:80] }}{% if change.new|length > 80 %}...{% endif %}</span>
                                    {% elif change.new and change.new is iterable and change.new is not string %}
                                        <br><span class="text-muted">({{ change.new|length }} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</span>
                                    {% endif %}
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </small>
                </div>
            </div>
        </div>
        {% endif %}
        
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% elif document.updated_at and not document.last_publish_at %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–æ—Ç –ú–ù–¢ –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ Confluence, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –µ—Å—Ç—å –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
{% endif %}

{% if document.confluence_page_url %}
<div class="alert alert-info">
    <strong>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ Confluence:</strong> <a href="{{ document.confluence_page_url }}" target="_blank">{{ document.confluence_page_url }}</a>
</div>
{% endif %}

{% if existing_attachments %}
<div class="form-section">
    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è –≤ Confluence</h3>
    <div class="table-responsive">
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–†–∞–∑–º–µ—Ä</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for attachment in existing_attachments %}
                <tr>
                    <td>{{ attachment.filename }}</td>
                    <td>{{ attachment.mediaType }}</td>
                    <td>{{ attachment.fileSize }} bytes</td>
                    <td>
                        <a href="/mnt/{{ document.id }}/attachment/{{ attachment.id }}/delete" 
                           class="btn btn-sm btn-danger" 
                           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–ª–æ–∂–µ–Ω–∏–µ?')">
                            –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<form method="post" action="/mnt/{{ document.id }}/edit" enctype="multipart/form-data">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div class="form-section" id="section-header">
        <h3>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="project_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="project_name" name="project_name" required 
                       value="{{ data.project_name if data else document.title }}">
            </div>
            <div class="col-md-6 mb-3">
                <label for="organization_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="organization_name" name="organization_name" required 
                       value="{{ data.organization_name if data else '' }}">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="system_version" class="form-label">–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="system_version" name="system_version" required 
                       value="{{ data.system_version if data else '' }}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1.0">
            </div>
            <div class="col-md-6 mb-3">
                <label for="author" class="form-label">–ê–≤—Ç–æ—Ä (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π) <span class="text-danger" id="author_required_star" style="display: none;">*</span></label>
                <input type="text" class="form-control" id="author" name="author" 
                       placeholder="–£–∫–∞–∂–∏—Ç–µ –§–ò–û –∞–≤—Ç–æ—Ä–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π)">
            </div>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 1: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <div class="form-section" id="section-1">
        <h3>1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
        <div class="mb-3">
            <label class="form-label">–¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π</label>
            <small class="text-muted d-block mb-2">–ï—Å–ª–∏ –≤—ã –≤–Ω–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ú–ù–¢, —É–∫–∞–∂–∏—Ç–µ –§–ò–û –∞–≤—Ç–æ—Ä–∞ –≤ –ø–æ–ª–µ "–ê–≤—Ç–æ—Ä" (–≤ —Ä–∞–∑–¥–µ–ª–µ "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞") - –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–æ–±–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ó–∞—Ç–µ–º —É–∫–∞–∂–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –±—ã–ª–æ, –º–æ–∂–µ—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ú–ù–¢ –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏—è.</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="history_changes_table" name="history_changes_table" value="{{ data.history_changes_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º –ø–æ–ª–µ–º –æ–ø–∏—Å–∞–Ω–∏—è -->
            <div class="table-responsive">
                <table class="table table-bordered" id="history_changes_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 20%;">–î–∞—Ç–∞</th>
                            <th style="width: 10%;">–í–µ—Ä—Å–∏—è</th>
                            <th style="width: 50%;">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th style="width: 20%;">–ê–≤—Ç–æ—Ä</th>
                        </tr>
                    </thead>
                    <tbody id="history_changes_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <small class="text-muted d-block mt-1">–í –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ "–û–ø–∏—Å–∞–Ω–∏–µ"</small>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 2: –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è -->
    <div class="form-section" id="section-2">
        <h3>2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</h3>
        <div class="mb-3">
            <label for="approval_list_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</label>
            <small class="text-muted d-block mb-2">–ü–æ–ª—è –§–ò–û, –î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –î–∞—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ–¥–ø–∏—Å—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ. –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="approval_list_table" name="approval_list_table" value="{{ data.approval_list_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="approval_list_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 22%;">–§–ò–û <span class="text-danger">*</span></th>
                            <th style="width: 22%;">–î–æ–ª–∂–Ω–æ—Å—Ç—å <span class="text-danger">*</span></th>
                            <th style="width: 22%;">–ü–æ–¥–ø–∏—Å—å</th>
                            <th style="width: 20%;">–î–∞—Ç–∞ <span class="text-danger">*</span></th>
                            <th style="width: 14%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="approval_list_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_approval_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 3: –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è -->
    <div class="form-section" id="section-3">
        <h3>3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</h3>
        
        <h4 class="mt-3 mb-3" id="section-3-1">3.1 –°–æ–∫—Ä–∞—â–µ–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="abbreviations_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="abbreviations_table" name="abbreviations_table" value="{{ data.abbreviations_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="abbreviations_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è <span class="text-danger">*</span></th>
                            <th style="width: 55%;">–û–ø–∏—Å–∞–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="abbreviations_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_abbreviation_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>

        <h4 class="mt-3 mb-3" id="section-3-2">3.2 –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</h4>
        <div class="mb-3">
            <label for="terminology_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="terminology_table" name="terminology_table" value="{{ data.terminology_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="terminology_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">–¢–µ—Ä–º–∏–Ω <span class="text-danger">*</span></th>
                            <th style="width: 55%;">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="terminology_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_terminology_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 4: –í–≤–µ–¥–µ–Ω–∏–µ -->
    <div class="form-section" id="section-4">
        <h3>4. –í–≤–µ–¥–µ–Ω–∏–µ</h3>
        <div class="mb-3">
            <label for="introduction_text" class="form-label">–¢–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω–∏—è</label>
            <textarea class="form-control" id="introduction_text" name="introduction_text" rows="10">{{ data.introduction_text if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 5: –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢ -->
    <div class="form-section" id="section-5">
        <h3>5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-5-1">5.1 –¶–µ–ª–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="goals_business" class="form-label">–ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏ (–∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="goals_business" name="goals_business" rows="5">{{ data.goals_business if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="goals_technical" class="form-label">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏ (–∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="goals_technical" name="goals_technical" rows="5">{{ data.goals_technical if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-5-2">5.2 –ó–∞–¥–∞—á–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="tasks_nt" class="form-label">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ù–¢ (–∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="tasks_nt" name="tasks_nt" rows="10">{{ data.tasks_nt if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 6: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢ -->
    <div class="form-section" id="section-6">
        <h3>6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-6-1">6.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–¢</h4>
        <div class="mb-3">
            <label for="limitations_list" class="form-label">–°–ø–∏—Å–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ù–¢ (–∫–∞–∂–¥–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="limitations_list" name="limitations_list" rows="15">{{ data.limitations_list if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-6-2">6.2 –†–∏—Å–∫–∏ –ù–¢</h4>
        <div class="mb-3">
            <label for="risks_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤ –ù–¢</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="risks_table" name="risks_table" value="{{ data.risks_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="risks_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 50%;">–†–∏—Å–∫ <span class="text-danger">*</span></th>
                            <th style="width: 25%;">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è <span class="text-danger">*</span></th>
                            <th style="width: 20%;">–í–ª–∏—è–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="risks_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_risk_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 7: –û–±—ä–µ–∫—Ç –ù–¢ -->
    <div class="form-section" id="section-7">
        <h3>7. –û–±—ä–µ–∫—Ç –ù–¢</h3>
        
        <h4 class="mt-3 mb-3" id="section-7-1">7.1 –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="object_general" class="form-label">–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ –ù–¢</label>
            <textarea class="form-control" id="object_general" name="object_general" rows="3">{{ data.object_general if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-7-2">7.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h4>
        <div class="mb-3">
            <label for="performance_requirements" class="form-label">–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="performance_requirements" name="performance_requirements" rows="6">{{ data.performance_requirements if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-7-3">7.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</h4>
        
        <h5 class="mt-2 mb-2">7.3.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
        <div class="mb-3">
            <label for="component_architecture_text" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="component_architecture_text" name="component_architecture_text" rows="6">{{ data.component_architecture_text if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="component_architecture_image_file" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–†–∏—Å—É–Ω–æ–∫ 1) - –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ</label>
            <input type="file" class="form-control" id="component_architecture_image_file" name="component_architecture_image_file" accept="image/*">
            <small class="text-muted">–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ–Ω–æ –∑–∞–º–µ–Ω–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ</small>
        </div>

        <h5 class="mt-3 mb-2">7.3.2 –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
        <div class="mb-3">
            <label for="information_architecture_image_file" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–†–∏—Å—É–Ω–æ–∫ 2) - –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ</label>
            <input type="file" class="form-control" id="information_architecture_image_file" name="information_architecture_image_file" accept="image/*">
            <small class="text-muted">–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ–Ω–æ –∑–∞–º–µ–Ω–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ</small>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 8: –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã -->
    <div class="form-section" id="section-8">
        <h3>8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</h3>
        
        <h4 class="mt-3 mb-3" id="section-8-1">8.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</h4>
        <div class="mb-3">
            <label for="test_stand_architecture_text" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</label>
            <textarea class="form-control" id="test_stand_architecture_text" name="test_stand_architecture_text" rows="4">{{ data.test_stand_architecture_text if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-8-2">8.2 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã –∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞</h4>
        <div class="mb-3">
            <label for="stand_comparison_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="stand_comparison_table" name="stand_comparison_table" value="{{ data.stand_comparison_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="stand_comparison_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">–°–∏—Å—Ç–µ–º–∞ <span class="text-danger">*</span></th>
                            <th style="width: 25%;">–ü–∞—Ä–∞–º–µ—Ç—Ä <span class="text-danger">*</span></th>
                            <th style="width: 25%;">–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ UAT –∫–æ–Ω—Ç—É—Ä–µ <span class="text-danger">*</span></th>
                            <th style="width: 20%;">–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="stand_comparison_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_stand_comparison_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 9: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="form-section" id="section-9">
        <h3>9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        
        <div class="mb-3">
            <label for="planned_tests_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="planned_tests_intro" name="planned_tests_intro" rows="3">{{ data.planned_tests_intro if data else '' }}</textarea>
        </div>
        
        <h4 class="mt-3 mb-3" id="section-9-1">9.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</h4>
        <div class="mb-3">
            <label for="planned_tests_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="planned_tests_table" name="planned_tests_table" value="{{ data.planned_tests_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="planned_tests_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">‚Ññ <span class="text-danger">*</span></th>
                            <th style="width: 25%;">–¢–µ—Å—Ç <span class="text-danger">*</span></th>
                            <th style="width: 20%;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ <span class="text-danger">*</span></th>
                            <th style="width: 45%;">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="planned_tests_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_planned_test_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
        <div class="mb-3">
            <div class="alert alert-info" role="alert" style="margin-bottom: 0;">
                * –ø—Ä–∏—Å—Ç—É–ø–∞—è –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã—è—Å–Ω–∏—Ç—å, –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–∏ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å? –ï—Å–ª–∏ –¥–∞, —Ç–æ –ø—Ä–æ–≤–æ–¥–∏–º —Ç–µ—Å—Ç. –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ —É–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ –≤ –ú–ù–¢ –∏ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –æ—Ç—á—ë—Ç–∞.
            </div>
        </div>

        <h4 class="mt-3 mb-3" id="section-9-2">9.2 –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢</h4>
        <div class="mb-3">
            <label for="completion_conditions" class="form-label">–°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ù–¢ (–∫–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
            <textarea class="form-control" id="completion_conditions" name="completion_conditions" rows="6">{{ data.completion_conditions if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 10: –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î -->
    <div class="form-section" id="section-10">
        <h3>10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</h3>
        <div class="mb-3">
            <label for="database_preparation_text" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î</label>
            <textarea class="form-control" id="database_preparation_text" name="database_preparation_text" rows="6">{{ data.database_preparation_text if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="database_preparation_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –æ–±—ä–µ–º–∞–º –¥–∞–Ω–Ω—ã—Ö</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="database_preparation_table" name="database_preparation_table" value="{{ data.database_preparation_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="database_preparation_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 30%;">–°—Ö–µ–º–∞.–¢–∞–±–ª–∏—Ü–∞ <span class="text-danger">*</span></th>
                            <th style="width: 35%;">–¢–µ–∫—É—â–µ–µ –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ <span class="text-danger">*</span></th>
                            <th style="width: 30%;">–ü—Ä–æ–≥–Ω–æ–∑ —Ä–æ—Å—Ç–∞ –≤ –¥–µ–Ω—å <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="database_preparation_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_database_preparation_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 11: –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="form-section" id="section-11">
        <h3>11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</h3>
        
        <h4 class="mt-3 mb-3" id="section-11-1">11.1 –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</h4>
        <div class="mb-3">
            <label for="load_modeling_principles" class="form-label">–¢–µ–∫—Å—Ç –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</label>
            <textarea class="form-control" id="load_modeling_principles" name="load_modeling_principles" rows="12">{{ data.load_modeling_principles if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-2">11.2 –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</h4>
        <div class="mb-3">
            <label for="load_profiles_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="load_profiles_intro" name="load_profiles_intro" rows="3">{% if data and data.get('load_profiles_intro') %}{{ data.load_profiles_intro }}{% else %}–í —Ç–∞–±–ª–∏—Ü–µ –Ω–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –ü—Ä–æ—Ñ–∏–ª—å –ù–¢ –†1 –±–∏–∑–Ω–µ—Å ‚Äì –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–æ —ç—Ç–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º –ø—Ä–∏–Ω—è—Ç—ã–µ –∑–∞ 100%. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—á–Ω—è –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ –æ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã, —Å —É—á—ë—Ç–æ–º –ø—Ä–∞–≤–æ–∫, –≤–Ω–µ—Å—ë–Ω–Ω—ã—Ö –ó–∞–∫–∞–∑—á–∏–∫–æ–º.{% endif %}</textarea>
        </div>
        <div class="mb-3">
            <label for="load_profiles_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="load_profiles_table" name="load_profiles_table" value="{{ data.load_profiles_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="load_profiles_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 50%;">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü <span class="text-danger">*</span></th>
                            <th style="width: 45%;">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\–º–∏–Ω—É—Ç–∞ <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="load_profiles_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_load_profiles_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-3">11.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h4>
        <div class="mb-3">
            <label for="use_scenarios_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="use_scenarios_intro" name="use_scenarios_intro" rows="3">{% if data and data.get('use_scenarios_intro') %}{{ data.use_scenarios_intro }}{% else %}–ü–µ—Ä–µ—á–µ–Ω—å —ç–º—É–ª–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –Ω–∏–∂–µ–ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ.{% endif %}</textarea>
        </div>
        <div class="mb-3">
            <label for="use_scenarios_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="use_scenarios_table" name="use_scenarios_table" value="{{ data.use_scenarios_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="use_scenarios_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 50%;">–®–∞–≥–∏ <span class="text-danger">*</span></th>
                            <th style="width: 45%;">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\–º–∏–Ω—É—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞—è –∑–∞ 100% <span class="text-danger">*</span></th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="use_scenarios_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_use_scenarios_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>

        <h4 class="mt-3 mb-3" id="section-11-4">11.4 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</h4>
        <div class="mb-3">
            <label for="emulators_description" class="form-label">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–æ–≤</label>
            <textarea class="form-control" id="emulators_description" name="emulators_description" rows="4">{{ data.emulators_description if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 12: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ -->
    <div class="form-section" id="section-12">
        <h3>12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
        
        <div class="mb-3">
            <label for="monitoring_intro" class="form-label">–û–±—â–∏–π –≤–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="monitoring_intro" name="monitoring_intro" rows="4">{{ data.monitoring_intro if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-12-1">12.1 –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
        <div class="mb-3">
            <label for="monitoring_tools_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="monitoring_tools_intro" name="monitoring_tools_intro" rows="2">{% if data and data.get('monitoring_tools_intro') %}{{ data.monitoring_tools_intro }}{% else %}–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ö–æ–¥–µ –ù–¢ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –¢–∞–±–ª–∏—Ü–∞ 11.{% endif %}</textarea>
        </div>
        <div class="mb-3">
            <label for="monitoring_tools_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="monitoring_tools_table" name="monitoring_tools_table" value="{{ data.monitoring_tools_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="monitoring_tools_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 30%;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ <span class="text-danger">*</span></th>
                            <th style="width: 35%;">–†–æ–ª—å <span class="text-danger">*</span></th>
                            <th style="width: 30%;">–≠–Ω–¥–ø–æ–∏–Ω—Ç (URI)</th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="monitoring_tools_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_monitoring_tools_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>
        <div class="mb-3">
            <label for="monitoring_tools_note" class="form-label">–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
            <textarea class="form-control" id="monitoring_tools_note" name="monitoring_tools_note" rows="8">{{ data.monitoring_tools_note if data else '' }}</textarea>
        </div>

        <h4 class="mt-3 mb-3" id="section-12-2">12.2 –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h4>
        
        <h5 class="mt-2 mb-2">12.2.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</h5>
        <div class="mb-3">
            <label for="system_resources_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="system_resources_intro" name="system_resources_intro" rows="2">{% if data and data.get('system_resources_intro') %}{{ data.system_resources_intro }}{% else %}–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Å–µ—Ä–≤–µ—Ä–æ–≤ –ë–î, —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å —ç–º—É–ª—è—Ç–æ—Ä–∞–º–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –º–µ—Ç—Ä–∏–∫, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ 12.{% endif %}</textarea>
        </div>
        <div class="mb-3">
            <label for="system_resources_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</label>
            <small class="text-muted d-block mb-2">–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É".</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä -->
            <input type="hidden" id="system_resources_table" name="system_resources_table" value="{{ data.system_resources_table if data else '' }}">
            
            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏ -->
            <div class="table-responsive">
                <table class="table table-bordered" id="system_resources_visual_table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">‚Ññ</th>
                            <th style="width: 20%;">–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏ <span class="text-danger">*</span></th>
                            <th style="width: 30%;">–°–ø–æ—Å–æ–± —Å–Ω—è—Ç–∏—è <span class="text-danger">*</span></th>
                            <th style="width: 22%;">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è <span class="text-danger">*</span></th>
                            <th style="width: 18%;">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</th>
                            <th style="width: 5%; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="system_resources_tbody">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add_system_resources_row_btn">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
            </button>
        </div>

        <h5 class="mt-3 mb-2">12.2.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫</h5>
        <div class="mb-3">
            <label for="business_metrics_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="business_metrics_intro" name="business_metrics_intro" rows="2">{{ data.business_metrics_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="business_metrics_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∞|–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="business_metrics_table" name="business_metrics_table" rows="10">{{ data.business_metrics_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 13: –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É -->
    <div class="form-section" id="section-13">
        <h3>13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</h3>
        <div class="mb-3">
            <label for="customer_requirements_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="customer_requirements_intro" name="customer_requirements_intro" rows="3">{{ data.customer_requirements_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_list" class="form-label">–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–∫–∞–∂–¥–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="customer_requirements_list" name="customer_requirements_list" rows="15">{{ data.customer_requirements_list if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_note_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
            <textarea class="form-control" id="customer_requirements_note_intro" name="customer_requirements_note_intro" rows="2">{{ data.customer_requirements_note_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="customer_requirements_note_list" class="form-label">–°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ä–æ–∫–æ–≤ (–∫–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –Ω—É–º–µ—Ä–æ–≤–∞—Ç—å)</label>
            <textarea class="form-control" id="customer_requirements_note_list" name="customer_requirements_note_list" rows="5">{{ data.customer_requirements_note_list if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 14: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ -->
    <div class="form-section" id="section-14">
        <h3>14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</h3>
        <div class="mb-3">
            <label for="deliverables_intro" class="form-label">–í–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <textarea class="form-control" id="deliverables_intro" name="deliverables_intro" rows="2">{{ data.deliverables_intro if data else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="deliverables_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –î–æ–∫—É–º–µ–Ω—Ç|–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="deliverables_table" name="deliverables_table" rows="8">{{ data.deliverables_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 15: –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
    <div class="form-section" id="section-15">
        <h3>15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
        <div class="mb-3">
            <label for="contacts_table" class="form-label">–¢–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Ü</label>
            <small class="text-muted d-block mb-2">–§–æ—Ä–º–∞—Ç: –ø/–ø|–§–ò–û|–°—Ñ–µ—Ä–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏|–ö–æ–Ω—Ç–∞–∫—Ç—ã (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)</small>
            <textarea class="form-control" id="contacts_table" name="contacts_table" rows="6">{{ data.contacts_table if data else '' }}</textarea>
        </div>
    </div>

    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –±–ª–æ–∫–∏ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
    <div id="custom-sections-container"></div>
    
    <div class="form-section" id="section-add-custom">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫</h3>
        <div class="mb-3">
            <label for="custom_section_title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="custom_section_title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 16. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã">
        </div>
        <div class="mb-3">
            <label for="custom_section_insert_after" class="form-label">–í—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –±–ª–æ–∫–∞</label>
            <select class="form-select" id="custom_section_insert_after">
                <option value="15">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã (–≤ –∫–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞)</option>
                <option value="1">1. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</option>
                <option value="2">2. –õ–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</option>
                <option value="3">3. –°–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è</option>
                <option value="4">4. –í–≤–µ–¥–µ–Ω–∏–µ</option>
                <option value="5">5. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –ù–¢</option>
                <option value="6">6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ –ù–¢</option>
                <option value="7">7. –û–±—ä–µ–∫—Ç –ù–¢</option>
                <option value="8">8. –¢–µ—Å—Ç–æ–≤—ã–π –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–Ω–¥—ã</option>
                <option value="9">9. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</option>
                <option value="10">10. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î</option>
                <option value="11">11. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</option>
                <option value="12">12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</option>
                <option value="13">13. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ó–∞–∫–∞–∑—á–∏–∫—É</option>
                <option value="14">14. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥–ª–µ–∂–∞—â–∏–µ —Å–¥–∞—á–µ</option>
                <option value="15">15. –ö–æ–Ω—Ç–∞–∫—Ç—ã</option>
            </select>
        </div>
        <button type="button" class="btn btn-primary" id="add-custom-section-btn">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
    </div>
    -->

    <!-- –¢–µ–≥–∏ -->
    <div class="form-section" id="section-tags">
        <h3>–¢–µ–≥–∏</h3>
        <div class="mb-3">
            <label for="tags" class="form-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            {% set existing_tags = data.tags if data and data.tags else [] %}
            <input type="text" 
                   class="form-control" 
                   id="tags" 
                   name="tags" 
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ—Ç—Ä–µ–π–¥, –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å"
                   value="{{ existing_tags|join(', ') if existing_tags else '' }}">
            <small class="form-text text-muted">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ—Ç—Ä–µ–π–¥, –ö–æ–º–∞–Ω–¥–∞ –ê, –ü—Ä–æ–µ–∫—Ç –ë</small>
        </div>
    </div>

    <!-- Confluence -->
    <div class="form-section" id="section-confluence">
        <h3>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Confluence</h3>
        
        {% if document.last_error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>‚ö† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong><br>
            <small>{{ document.last_error }}</small>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="confluence_space" class="form-label">Space Key <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="confluence_space" name="confluence_space" required 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: TEST" value="{{ document.confluence_space or '' }}">
                <small class="form-text text-muted">
                    –ö–ª—é—á –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (Space) –≤ Confluence, –≥–¥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–ù–¢. 
                    –≠—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–æ–±—ã—á–Ω–æ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ).
                    <br><strong>–ö–∞–∫ –Ω–∞–π—Ç–∏ Space Key:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ Confluence –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ URL ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>spaceKey=TEST</code> –∏–ª–∏ –ø—É—Ç—å <code>/spaces/TEST/</code>
                </small>
            </div>
            <div class="col-md-6 mb-3">
                <label for="confluence_parent_id" class="form-label">Parent Page ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="number" class="form-control" id="confluence_parent_id" name="confluence_parent_id" 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456" value="{{ document.confluence_parent_id or '' }}">
                <small class="form-text text-muted">
                    ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Confluence, –ø–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ú–ù–¢ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü). 
                    –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.
                    <br><strong>–ö–∞–∫ –Ω–∞–π—Ç–∏ ID:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Confluence –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ URL ‚Äî —Ç–∞–º –±—É–¥–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>pageId=123456</code>
                </small>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è -->
    <input type="hidden" name="publish" id="publish_hidden" value="">
    
    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="d-flex gap-2 mb-4">
        <button type="submit" class="btn btn-primary" onclick="document.getElementById('publish_hidden').value='1';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤ Confluence</button>
        <button type="submit" class="btn btn-secondary" onclick="document.getElementById('publish_hidden').value='';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å (–±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏)</button>
        <a href="/mnt/{{ document.id }}/preview" target="_blank" class="btn btn-outline-info">üëÅÔ∏è –ü—Ä–µ–≤—å—é</a>
        <a href="/mnt/{{ document.id }}/versions" class="btn btn-outline-secondary">üìö –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π</a>
        <div class="btn-group">
            <button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/mnt/{{ document.id }}/export/html">–≠–∫—Å–ø–æ—Ä—Ç –≤ HTML</a></li>
                <li><a class="dropdown-item" href="/mnt/{{ document.id }}/export/txt">–≠–∫—Å–ø–æ—Ä—Ç –≤ TXT</a></li>
            </ul>
        </div>
        <a href="/mnt/list" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="/static/js/table-editor.js"></script>
<script src="/static/js/form-validation.js"></script>
<script src="/static/js/auto-save.js"></script>
<script src="/static/js/image-preview.js"></script>
<script src="/static/js/unsaved-changes.js"></script>
<script>
// –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    const authorInput = document.getElementById('author');
    const historyTableHidden = document.getElementById('history_changes_table');
    const historyTableTbody = document.getElementById('history_changes_tbody');
    
    if (!historyTableHidden || !historyTableTbody) return;
    
    // –ò—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞ - –≤—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–µ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    let originalAuthor = '';
    let newRowAdded = false; // –§–ª–∞–≥, —á—Ç–æ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞
    let historyLoaded = false; // –§–ª–∞–≥, —á—Ç–æ –∏—Å—Ç–æ—Ä–∏—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è
    function loadExistingHistory() {
        const historyData = historyTableHidden.value.trim();
        if (!historyData) {
            historyTableTbody.innerHTML = '';
            historyLoaded = true;
            return;
        }
        
        const lines = historyData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            historyTableTbody.innerHTML = '';
            historyLoaded = true;
            return;
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        const rows = [];
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 4) {
                rows.push({
                    date: parts[0],
                    version: parts[1],
                    description: parts[2],
                    author: parts[3]
                });
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ (–≤—Å–µ readonly - –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        historyTableTbody.innerHTML = rows.map((row, index) => {
            return `
                <tr>
                    <td>${row.date}</td>
                    <td>${row.version}</td>
                    <td>${row.description}</td>
                    <td>${row.author}</td>
                </tr>
            `;
        }).join('');
        
        historyLoaded = true;
        updateHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ –∞–≤—Ç–æ—Ä–∞
    function addOrUpdateNewHistoryRow() {
        if (!historyLoaded) return; // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
        
        const author = authorInput ? authorInput.value.trim() : '';
        if (!author) {
            // –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä –ø—É—Å—Ç–æ–π, —É–¥–∞–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É (–µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞)
            const lastRow = historyTableTbody.querySelector('tr:last-child');
            if (lastRow && lastRow.querySelector('input[name="history_description_new"]')) {
                lastRow.remove();
                newRowAdded = false;
                updateHiddenField();
            }
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (—Å input –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è)
        let newRow = historyTableTbody.querySelector('tr:has(input[name="history_description_new"])');
        
        if (!newRow) {
            // –ù–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –µ—ë
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const dateStr = `${day}.${month}.${year}`;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–µ–¥—É—é—â—É—é –≤–µ—Ä—Å–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫
            const existingRows = historyTableTbody.querySelectorAll('tr');
            let nextVersion = '0.2';
            
            if (existingRows.length > 0) {
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫ (–Ω–µ –Ω–æ–≤–æ–π)
                for (let i = existingRows.length - 1; i >= 0; i--) {
                    const row = existingRows[i];
                    if (!row.querySelector('input[name="history_description_new"]')) {
                        const versionCell = row.querySelectorAll('td')[1];
                        if (versionCell) {
                            const lastVersion = versionCell.textContent.trim();
                            const versionParts = lastVersion.split('.');
                            if (versionParts.length === 2) {
                                try {
                                    const major = parseInt(versionParts[0]);
                                    const minor = parseInt(versionParts[1]) + 1;
                                    nextVersion = `${major}.${minor}`;
                                } catch (e) {
                                    nextVersion = '0.2';
                                }
                            }
                        }
                        break;
                    }
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω–µ—Ü —Ç–∞–±–ª–∏—Ü—ã
            newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${dateStr}</td>
                <td>${nextVersion}</td>
                <td>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           name="history_description_new" 
                           value=""
                           placeholder="–û–ø–∏—à–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è">
                </td>
                <td></td>
            `;
            historyTableTbody.appendChild(newRow);
            newRowAdded = true;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤—Ç–æ—Ä–∞ –≤ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ (–æ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏)
        const authorCell = newRow.querySelectorAll('td')[3];
        if (authorCell) {
            authorCell.textContent = author;
        }
        
        updateHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateHiddenField() {
        if (!historyTableTbody || !historyTableHidden) return;
        
        const rows = historyTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            historyTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–î–∞—Ç–∞|–í–µ—Ä—Å–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ|–ê–≤—Ç–æ—Ä'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 4) {
                const date = cells[0].textContent.trim();
                const version = cells[1].textContent.trim();
                const descInput = cells[2].querySelector('input');
                const description = descInput ? descInput.value.trim() : cells[2].textContent.trim();
                const author = cells[3].textContent.trim();
                parts.push(`${date}|${version}|${description}|${author}`);
            }
        });
        
        historyTableHidden.value = parts.join('\n');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è
    if (historyTableTbody) {
        historyTableTbody.addEventListener('input', function(e) {
            if (e.target.name && e.target.name.startsWith('history_description')) {
                updateHiddenField();
            }
        });
    }
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤–≤–æ–¥ –∞–≤—Ç–æ—Ä–∞ (–¥–æ–±–∞–≤–ª—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ)
    if (authorInput) {
        authorInput.addEventListener('input', function() {
            addOrUpdateNewHistoryRow();
        });
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingHistory();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateHiddenField();
        });
    }
});
</script>

<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const approvalTableHidden = document.getElementById('approval_list_table');
    const approvalTableTbody = document.getElementById('approval_list_tbody');
    const addApprovalRowBtn = document.getElementById('add_approval_row_btn');
    
    if (!approvalTableHidden || !approvalTableTbody) {
        console.error('Approval table elements not found');
        return;
    }
    
    console.log('Approval table script loaded, button:', addApprovalRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç DD.MM.YYYY
    function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}.${month}.${year}`;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD –¥–ª—è input[type="date"]
    function formatDateForInput(date) {
        if (!date) {
            const today = new Date();
            return today.toISOString().split('T')[0]; // YYYY-MM-DD
        }
        // –ï—Å–ª–∏ –¥–∞—Ç–∞ —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
        if (date.match(/^\d{4}-\d{2}-\d{2}$/)) {
            return date;
        }
        // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ YYYY-MM-DD
        if (date.match(/^\d{2}\.\d{2}\.\d{4}$/)) {
            const [day, month, year] = date.split('.');
            return `${year}-${month}-${day}`;
        }
        // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç Date, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º
        if (date instanceof Date) {
            return date.toISOString().split('T')[0];
        }
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        return new Date().toISOString().split('T')[0];
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createApprovalRow(rowData = { fio: '', position: '', signature: '', date: null }) {
        const row = document.createElement('tr');
        const dateValue = formatDateForInput(rowData.date);
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm approval-fio" 
                       name="approval_fio[]" 
                       value="${rowData.fio || ''}"
                       placeholder="–§–∞–º–∏–ª–∏—è –ò.–û."
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm approval-position" 
                       name="approval_position[]" 
                       value="${rowData.position || ''}"
                       placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm approval-signature" 
                       name="approval_signature[]" 
                       value="${rowData.signature || ''}"
                       placeholder="–ü–æ–¥–ø–∏—Å—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
            </td>
            <td>
                <input type="date" 
                       class="form-control form-control-sm approval-date" 
                       name="approval_date[]" 
                       value="${dateValue}"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-approval-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingApprovalData() {
        const approvalData = approvalTableHidden.value.trim();
        
        if (!approvalData) {
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const defaultRow = createApprovalRow();
            approvalTableTbody.appendChild(defaultRow);
            updateApprovalHiddenField();
            return;
        }
        
        const lines = approvalData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ - –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
            const defaultRow = createApprovalRow();
            approvalTableTbody.appendChild(defaultRow);
            updateApprovalHiddenField();
            return;
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 4) {
                const rowData = {
                    fio: parts[0] || '',
                    position: parts[1] || '',
                    signature: parts[2] || '',
                    date: parts[3] || null // formatDateForInput –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç null –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                };
                const row = createApprovalRow(rowData);
                approvalTableTbody.appendChild(row);
            }
        }
        
        updateApprovalHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateApprovalHiddenField() {
        const rows = approvalTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            approvalTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–§–ò–û|–î–æ–ª–∂–Ω–æ—Å—Ç—å|–ü–æ–¥–ø–∏—Å—å|–î–∞—Ç–∞'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const fioInput = row.querySelector('.approval-fio');
            const positionInput = row.querySelector('.approval-position');
            const signatureInput = row.querySelector('.approval-signature');
            const dateInput = row.querySelector('.approval-date');
            
            if (fioInput && positionInput && signatureInput && dateInput) {
                const fio = fioInput.value.trim();
                const position = positionInput.value.trim();
                const signature = signatureInput.value.trim();
                let date = dateInput.value.trim();
                
                // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ DD.MM.YYYY
                if (date && date.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    const [year, month, day] = date.split('-');
                    date = `${day}.${month}.${year}`;
                }
                
                parts.push(`${fio}|${position}|${signature}|${date}`);
            }
        });
        
        approvalTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addApprovalRowBtn) {
        console.log('Adding click handler to approval row button');
        addApprovalRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add approval row button clicked');
            const newRow = createApprovalRow();
            approvalTableTbody.appendChild(newRow);
            updateApprovalHiddenField();
        });
    } else {
        console.error('Add approval row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    approvalTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-approval-row')) {
            const row = e.target.closest('tr');
            if (row) {
                // –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É
                if (approvalTableTbody.querySelectorAll('tr').length > 1) {
                    row.remove();
                    updateApprovalHiddenField();
                } else {
                    alert('–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ');
                }
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    approvalTableTbody.addEventListener('input', function() {
        updateApprovalHiddenField();
    });
    
    approvalTableTbody.addEventListener('change', function() {
        updateApprovalHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingApprovalData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateApprovalHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π
document.addEventListener('DOMContentLoaded', function() {
    const abbreviationsTableHidden = document.getElementById('abbreviations_table');
    const abbreviationsTableTbody = document.getElementById('abbreviations_tbody');
    const addAbbreviationRowBtn = document.getElementById('add_abbreviation_row_btn');
    
    if (!abbreviationsTableHidden || !abbreviationsTableTbody) {
        console.error('Abbreviations table elements not found');
        return;
    }
    
    console.log('Abbreviations table script loaded, button:', addAbbreviationRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createAbbreviationRow(rowData = { name: '', description: '' }) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm abbreviation-name" 
                       name="abbreviation_name[]" 
                       value="${rowData.name || ''}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–ù–¢"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm abbreviation-description" 
                       name="abbreviation_description[]" 
                       value="${rowData.description || ''}"
                       placeholder="–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-abbreviation-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingAbbreviationData() {
        const abbreviationData = abbreviationsTableHidden.value.trim();
        
        if (!abbreviationData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = abbreviationData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    name: parts[0] || '',
                    description: parts[1] || ''
                };
                const row = createAbbreviationRow(rowData);
                abbreviationsTableTbody.appendChild(row);
            }
        }
        
        updateAbbreviationHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateAbbreviationHiddenField() {
        const rows = abbreviationsTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            abbreviationsTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const nameInput = row.querySelector('.abbreviation-name');
            const descriptionInput = row.querySelector('.abbreviation-description');
            
            if (nameInput && descriptionInput) {
                const name = nameInput.value.trim();
                const description = descriptionInput.value.trim();
                if (name || description) {
                    parts.push(`${name}|${description}`);
                }
            }
        });
        
        abbreviationsTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addAbbreviationRowBtn) {
        console.log('Adding click handler to abbreviation row button');
        addAbbreviationRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add abbreviation row button clicked');
            const newRow = createAbbreviationRow();
            abbreviationsTableTbody.appendChild(newRow);
            updateAbbreviationHiddenField();
        });
    } else {
        console.error('Add abbreviation row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    abbreviationsTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-abbreviation-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateAbbreviationHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    abbreviationsTableTbody.addEventListener('input', function() {
        updateAbbreviationHiddenField();
    });
    
    abbreviationsTableTbody.addEventListener('change', function() {
        updateAbbreviationHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingAbbreviationData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateAbbreviationHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    const terminologyTableHidden = document.getElementById('terminology_table');
    const terminologyTableTbody = document.getElementById('terminology_tbody');
    const addTerminologyRowBtn = document.getElementById('add_terminology_row_btn');
    
    if (!terminologyTableHidden || !terminologyTableTbody) {
        console.error('Terminology table elements not found');
        return;
    }
    
    console.log('Terminology table script loaded, button:', addTerminologyRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createTerminologyRow(rowData = { term: '', definition: '' }) {
        const row = document.createElement('tr');
        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        let definitionValue = (rowData.definition || '').replace(/\[IMAGE:[^\]]+\]/g, '').trim();
        definitionValue = definitionValue.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        const termValue = (rowData.term || '').replace(/"/g, '&quot;');
        
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm terminology-term" 
                       name="terminology_term[]" 
                       value="${termValue}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
                       required>
            </td>
            <td>
                <textarea class="form-control form-control-sm terminology-definition" 
                       name="terminology_definition[]" 
                       rows="3"
                       placeholder="–ü—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π"
                       required>${definitionValue}</textarea>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-terminology-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingTerminologyData() {
        const terminologyData = terminologyTableHidden.value.trim();
        
        if (!terminologyData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = terminologyData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    term: parts[0] || '',
                    definition: parts[1] || ''
                };
                const row = createTerminologyRow(rowData);
                terminologyTableTbody.appendChild(row);
            }
        }
        
        updateTerminologyHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateTerminologyHiddenField() {
        const rows = terminologyTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            terminologyTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–¢–µ—Ä–º–∏–Ω|–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const termInput = row.querySelector('.terminology-term');
            const definitionInput = row.querySelector('.terminology-definition');
            
            if (termInput && definitionInput) {
                const term = termInput.value.trim();
                const definition = definitionInput.value.trim();
                
                if (term || definition) {
                    parts.push(`${term}|${definition}`);
                }
            }
        });
        
        terminologyTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addTerminologyRowBtn) {
        console.log('Adding click handler to terminology row button');
        addTerminologyRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add terminology row button clicked');
            const newRow = createTerminologyRow();
            terminologyTableTbody.appendChild(newRow);
            updateTerminologyHiddenField();
        });
    } else {
        console.error('Add terminology row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    terminologyTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-terminology-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateTerminologyHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    terminologyTableTbody.addEventListener('input', function() {
        updateTerminologyHiddenField();
    });
    
    terminologyTableTbody.addEventListener('change', function() {
        updateTerminologyHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingTerminologyData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateTerminologyHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–∏—Å–∫–æ–≤ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Ä–∏—Å–∫–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const risksTableHidden = document.getElementById('risks_table');
    const risksTableTbody = document.getElementById('risks_tbody');
    const addRiskRowBtn = document.getElementById('add_risk_row_btn');
    
    if (!risksTableHidden || !risksTableTbody) {
        console.error('Risks table elements not found');
        return;
    }
    
    console.log('Risks table script loaded, button:', addRiskRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createRiskRow(rowData = { risk: '', probability: '', impact: '' }) {
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm risk-risk" 
                       name="risk_risk[]" 
                       value="${(rowData.risk || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –°–ù–¢ –≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm risk-probability" 
                       name="risk_probability[]" 
                       value="${(rowData.probability || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ä–µ–¥–Ω—è—è"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm risk-impact" 
                       name="risk_impact[]" 
                       value="${(rowData.impact || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ä–æ–∫–∏ –ù–¢"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-risk-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingRiskData() {
        const risksData = risksTableHidden.value.trim();
        
        if (!risksData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = risksData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 3) {
                const rowData = {
                    risk: parts[0] || '',
                    probability: parts[1] || '',
                    impact: parts[2] || ''
                };
                const row = createRiskRow(rowData);
                risksTableTbody.appendChild(row);
            }
        }
        
        updateRiskHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateRiskHiddenField() {
        const rows = risksTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            risksTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–†–∏—Å–∫|–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è|–í–ª–∏—è–Ω–∏–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const riskInput = row.querySelector('.risk-risk');
            const probabilityInput = row.querySelector('.risk-probability');
            const impactInput = row.querySelector('.risk-impact');
            
            if (riskInput && probabilityInput && impactInput) {
                const risk = riskInput.value.trim();
                const probability = probabilityInput.value.trim();
                const impact = impactInput.value.trim();
                if (risk || probability || impact) {
                    parts.push(`${risk}|${probability}|${impact}`);
                }
            }
        });
        
        risksTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addRiskRowBtn) {
        console.log('Adding click handler to risk row button');
        addRiskRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add risk row button clicked');
            const newRow = createRiskRow();
            risksTableTbody.appendChild(newRow);
            updateRiskHiddenField();
        });
    } else {
        console.error('Add risk row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    risksTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-risk-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateRiskHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    risksTableTbody.addEventListener('input', function() {
        updateRiskHiddenField();
    });
    
    risksTableTbody.addEventListener('change', function() {
        updateRiskHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingRiskData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateRiskHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç–µ–Ω–¥–æ–≤ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç–µ–Ω–¥–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const standComparisonTableHidden = document.getElementById('stand_comparison_table');
    const standComparisonTableTbody = document.getElementById('stand_comparison_tbody');
    const addStandComparisonRowBtn = document.getElementById('add_stand_comparison_row_btn');
    
    if (!standComparisonTableHidden || !standComparisonTableTbody) {
        console.error('Stand comparison table elements not found');
        return;
    }
    
    console.log('Stand comparison table script loaded, button:', addStandComparisonRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createStandComparisonRow(rowData = { system: '', parameter: '', test_value: '', prod_value: '' }) {
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm stand-system" 
                       name="stand_system[]" 
                       value="${(rowData.system || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–ª–∞—Å—Ç–µ—Ä –∏–∑ —Ç—Ä—ë—Ö –Ω–æ–¥"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm stand-parameter" 
                       name="stand_parameter[]" 
                       value="${(rowData.parameter || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–º–µ–Ω–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm stand-test-value" 
                       name="stand_test_value[]" 
                       value="${(rowData.test_value || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: site-dbapp-lt-01"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm stand-prod-value" 
                       name="stand_prod_value[]" 
                       value="${(rowData.prod_value || '').replace(/"/g, '&quot;')}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Site-dbapp-p-05"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-stand-comparison-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingStandComparisonData() {
        const standComparisonData = standComparisonTableHidden.value.trim();
        
        if (!standComparisonData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = standComparisonData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 4) {
                const rowData = {
                    system: parts[0] || '',
                    parameter: parts[1] || '',
                    test_value: parts[2] || '',
                    prod_value: parts[3] || ''
                };
                const row = createStandComparisonRow(rowData);
                standComparisonTableTbody.appendChild(row);
            }
        }
        
        updateStandComparisonHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateStandComparisonHiddenField() {
        const rows = standComparisonTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            standComparisonTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–°–∏—Å—Ç–µ–º–∞|–ü–∞—Ä–∞–º–µ—Ç—Ä|–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ UAT –∫–æ–Ω—Ç—É—Ä–µ|–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const systemInput = row.querySelector('.stand-system');
            const parameterInput = row.querySelector('.stand-parameter');
            const testValueInput = row.querySelector('.stand-test-value');
            const prodValueInput = row.querySelector('.stand-prod-value');
            
            if (systemInput && parameterInput && testValueInput && prodValueInput) {
                const system = systemInput.value.trim();
                const parameter = parameterInput.value.trim();
                const testValue = testValueInput.value.trim();
                const prodValue = prodValueInput.value.trim();
                if (system || parameter || testValue || prodValue) {
                    parts.push(`${system}|${parameter}|${testValue}|${prodValue}`);
                }
            }
        });
        
        standComparisonTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addStandComparisonRowBtn) {
        console.log('Adding click handler to stand comparison row button');
        addStandComparisonRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add stand comparison row button clicked');
            const newRow = createStandComparisonRow();
            standComparisonTableTbody.appendChild(newRow);
            updateStandComparisonHiddenField();
        });
    } else {
        console.error('Add stand comparison row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    standComparisonTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-stand-comparison-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateStandComparisonHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    standComparisonTableTbody.addEventListener('input', function() {
        updateStandComparisonHiddenField();
    });
    
    standComparisonTableTbody.addEventListener('change', function() {
        updateStandComparisonHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingStandComparisonData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateStandComparisonHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ç–µ—Å—Ç–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const plannedTestsTableHidden = document.getElementById('planned_tests_table');
    const plannedTestsTableTbody = document.getElementById('planned_tests_tbody');
    const addPlannedTestRowBtn = document.getElementById('add_planned_test_row_btn');
    
    if (!plannedTestsTableHidden || !plannedTestsTableTbody) {
        console.error('Planned tests table elements not found');
        return;
    }
    
    console.log('Planned tests table script loaded, button:', addPlannedTestRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createPlannedTestRow(rowData = { number: '', test: '', duration: '', description: '' }) {
        const row = document.createElement('tr');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω
        let rowNumber = rowData.number;
        if (!rowNumber) {
            const existingRows = plannedTestsTableTbody.querySelectorAll('tr');
            rowNumber = (existingRows.length + 1).toString();
        }
        
        row.innerHTML = `
            <td style="text-align: center; vertical-align: middle;">
                <span class="planned-test-number" style="font-weight: bold; font-size: 1.1rem; color: #212529;">${rowNumber}</span>
                <input type="hidden" name="planned_test_number[]" value="${rowNumber}">
            </td>
            <td>
                <textarea class="form-control form-control-sm planned-test-name" 
                       name="planned_test_name[]" 
                       rows="2"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–∏—Å–∫ –º–∞–∫—Å–∏–º—É–º–∞"
                       required>${(rowData.test || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
            </td>
            <td>
                <textarea class="form-control form-control-sm planned-test-duration" 
                       name="planned_test_duration[]" 
                       rows="2"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2 —á–∞—Å–∞"
                       required>${(rowData.duration || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
            </td>
            <td>
                <textarea class="form-control form-control-sm planned-test-description" 
                       name="planned_test_description[]" 
                       rows="3"
                       placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"
                       required>${(rowData.description || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-planned-test-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingPlannedTestData() {
        const plannedTestsData = plannedTestsTableHidden.value.trim();
        
        if (!plannedTestsData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = plannedTestsData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 4) {
                const rowData = {
                    number: parts[0] || '',
                    test: parts[1] || '',
                    duration: parts[2] || '',
                    description: parts[3] || ''
                };
                const row = createPlannedTestRow(rowData);
                plannedTestsTableTbody.appendChild(row);
            }
        }
        
        updatePlannedTestHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updatePlannedTestHiddenField() {
        const rows = plannedTestsTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            plannedTestsTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('‚Ññ|–¢–µ—Å—Ç|–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞|–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const numberHidden = row.querySelector('input[name="planned_test_number[]"]');
            const testInput = row.querySelector('.planned-test-name');
            const durationInput = row.querySelector('.planned-test-duration');
            const descriptionInput = row.querySelector('.planned-test-description');
            
            if (numberHidden && testInput && durationInput && descriptionInput) {
                const number = numberHidden.value.trim();
                const test = testInput.value.trim();
                const duration = durationInput.value.trim();
                const description = descriptionInput.value.trim();
                if (number || test || duration || description) {
                    parts.push(`${number}|${test}|${duration}|${description}`);
                }
            }
        });
        
        plannedTestsTableHidden.value = parts.join('\n');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
    function renumberRows() {
        const rows = plannedTestsTableTbody.querySelectorAll('tr');
        rows.forEach((row, index) => {
            const numberSpan = row.querySelector('.planned-test-number');
            const numberHidden = row.querySelector('input[name="planned_test_number[]"]');
            const newNumber = (index + 1).toString();
            if (numberSpan) {
                numberSpan.textContent = newNumber;
            }
            if (numberHidden) {
                numberHidden.value = newNumber;
            }
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addPlannedTestRowBtn) {
        console.log('Adding click handler to planned test row button');
        addPlannedTestRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add planned test row button clicked');
            const newRow = createPlannedTestRow();
            plannedTestsTableTbody.appendChild(newRow);
            renumberRows(); // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
            updatePlannedTestHiddenField();
        });
    } else {
        console.error('Add planned test row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    plannedTestsTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-planned-test-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                renumberRows(); // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
                updatePlannedTestHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    plannedTestsTableTbody.addEventListener('input', function() {
        updatePlannedTestHiddenField();
    });
    
    plannedTestsTableTbody.addEventListener('change', function() {
        updatePlannedTestHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingPlannedTestData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updatePlannedTestHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –æ–±—ä–µ–º–∞–º –¥–∞–Ω–Ω—ã—Ö -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –æ–±—ä–µ–º–∞–º –¥–∞–Ω–Ω—ã—Ö
document.addEventListener('DOMContentLoaded', function() {
    const databasePreparationTableHidden = document.getElementById('database_preparation_table');
    const databasePreparationTableTbody = document.getElementById('database_preparation_tbody');
    const addDatabasePreparationRowBtn = document.getElementById('add_database_preparation_row_btn');
    
    if (!databasePreparationTableHidden || !databasePreparationTableTbody) {
        console.error('Database preparation table elements not found');
        return;
    }
    
    console.log('Database preparation table script loaded, button:', addDatabasePreparationRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createDatabasePreparationRow(rowData = { schema_table: '', current_rows: '', growth_per_day: '' }) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm database-prep-schema-table" 
                       name="database_prep_schema_table[]" 
                       value="${rowData.schema_table || ''}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: public.users"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm database-prep-current-rows" 
                       name="database_prep_current_rows[]" 
                       value="${rowData.current_rows || ''}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000000"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm database-prep-growth-per-day" 
                       name="database_prep_growth_per_day[]" 
                       value="${rowData.growth_per_day || ''}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-database-prep-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingDatabasePreparationData() {
        const databasePreparationData = databasePreparationTableHidden.value.trim();
        
        if (!databasePreparationData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = databasePreparationData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 3) {
                const rowData = {
                    schema_table: parts[0] || '',
                    current_rows: parts[1] || '',
                    growth_per_day: parts[2] || ''
                };
                const row = createDatabasePreparationRow(rowData);
                databasePreparationTableTbody.appendChild(row);
            }
        }
        
        updateDatabasePreparationHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateDatabasePreparationHiddenField() {
        const rows = databasePreparationTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            databasePreparationTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–°—Ö–µ–º–∞.–¢–∞–±–ª–∏—Ü–∞|–¢–µ–∫—É—â–µ–µ –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ|–ü—Ä–æ–≥–Ω–æ–∑ —Ä–æ—Å—Ç–∞ –≤ –¥–µ–Ω—å'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const schemaTableInput = row.querySelector('.database-prep-schema-table');
            const currentRowsInput = row.querySelector('.database-prep-current-rows');
            const growthPerDayInput = row.querySelector('.database-prep-growth-per-day');
            
            if (schemaTableInput && currentRowsInput && growthPerDayInput) {
                const schemaTable = schemaTableInput.value.trim();
                const currentRows = currentRowsInput.value.trim();
                const growthPerDay = growthPerDayInput.value.trim();
                if (schemaTable || currentRows || growthPerDay) {
                    parts.push(`${schemaTable}|${currentRows}|${growthPerDay}`);
                }
            }
        });
        
        databasePreparationTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addDatabasePreparationRowBtn) {
        console.log('Adding click handler to database preparation row button');
        addDatabasePreparationRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add database preparation row button clicked');
            const newRow = createDatabasePreparationRow();
            databasePreparationTableTbody.appendChild(newRow);
            updateDatabasePreparationHiddenField();
        });
    } else {
        console.error('Add database preparation row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    databasePreparationTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-database-prep-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateDatabasePreparationHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    databasePreparationTableTbody.addEventListener('input', function() {
        updateDatabasePreparationHiddenField();
    });
    
    databasePreparationTableTbody.addEventListener('change', function() {
        updateDatabasePreparationHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingDatabasePreparationData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateDatabasePreparationHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    const loadProfilesTableHidden = document.getElementById('load_profiles_table');
    const loadProfilesTableTbody = document.getElementById('load_profiles_tbody');
    const addLoadProfilesRowBtn = document.getElementById('add_load_profiles_row_btn');
    
    if (!loadProfilesTableHidden || !loadProfilesTableTbody) {
        console.error('Load profiles table elements not found');
        return;
    }
    
    console.log('Load profiles table script loaded, button:', addLoadProfilesRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createLoadProfilesRow(rowData = { page_name: '', intensity: '' }) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm load-profile-page-name" 
                       name="load_profile_page_name[]" 
                       value="${rowData.page_name || ''}"
                       placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm load-profile-intensity" 
                       name="load_profile_intensity[]" 
                       value="${rowData.intensity || ''}"
                       placeholder="–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å, –æ–ø–µ—Ä–∞—Ü–∏–π/–º–∏–Ω—É—Ç–∞"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-load-profile-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingLoadProfilesData() {
        const loadProfilesData = loadProfilesTableHidden.value.trim();
        
        if (!loadProfilesData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = loadProfilesData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    page_name: parts[0] || '',
                    intensity: parts[1] || ''
                };
                const row = createLoadProfilesRow(rowData);
                loadProfilesTableTbody.appendChild(row);
            }
        }
        
        updateLoadProfilesHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateLoadProfilesHiddenField() {
        const rows = loadProfilesTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            loadProfilesTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\\–º–∏–Ω—É—Ç–∞'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const pageNameInput = row.querySelector('.load-profile-page-name');
            const intensityInput = row.querySelector('.load-profile-intensity');
            
            if (pageNameInput && intensityInput) {
                const pageName = pageNameInput.value.trim();
                const intensity = intensityInput.value.trim();
                if (pageName || intensity) {
                    parts.push(`${pageName}|${intensity}`);
                }
            }
        });
        
        loadProfilesTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addLoadProfilesRowBtn) {
        console.log('Adding click handler to load profiles row button');
        addLoadProfilesRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add load profiles row button clicked');
            const newRow = createLoadProfilesRow();
            loadProfilesTableTbody.appendChild(newRow);
            updateLoadProfilesHiddenField();
        });
    } else {
        console.error('Add load profiles row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    loadProfilesTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-load-profile-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateLoadProfilesHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    loadProfilesTableTbody.addEventListener('input', function() {
        updateLoadProfilesHiddenField();
    });
    
    loadProfilesTableTbody.addEventListener('change', function() {
        updateLoadProfilesHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingLoadProfilesData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateLoadProfilesHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const useScenariosTableHidden = document.getElementById('use_scenarios_table');
    const useScenariosTableTbody = document.getElementById('use_scenarios_tbody');
    const addUseScenariosRowBtn = document.getElementById('add_use_scenarios_row_btn');
    
    if (!useScenariosTableHidden || !useScenariosTableTbody) {
        console.error('Use scenarios table elements not found');
        return;
    }
    
    console.log('Use scenarios table script loaded, button:', addUseScenariosRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createUseScenariosRow(rowData = { steps: '', intensity: '' }) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm use-scenario-steps" 
                       name="use_scenario_steps[]" 
                       value="${rowData.steps || ''}"
                       placeholder="–®–∞–≥–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm use-scenario-intensity" 
                       name="use_scenario_intensity[]" 
                       value="${rowData.intensity || ''}"
                       placeholder="–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å, –æ–ø–µ—Ä–∞—Ü–∏–π/–º–∏–Ω—É—Ç–∞"
                       required>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-use-scenario-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingUseScenariosData() {
        const useScenariosData = useScenariosTableHidden.value.trim();
        
        if (!useScenariosData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = useScenariosData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    steps: parts[0] || '',
                    intensity: parts[1] || ''
                };
                const row = createUseScenariosRow(rowData);
                useScenariosTableTbody.appendChild(row);
            }
        }
        
        updateUseScenariosHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateUseScenariosHiddenField() {
        const rows = useScenariosTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            useScenariosTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–®–∞–≥–∏|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–ø–µ—Ä–∞—Ü–∏–π\\–º–∏–Ω—É—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞—è –∑–∞ 100%'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const stepsInput = row.querySelector('.use-scenario-steps');
            const intensityInput = row.querySelector('.use-scenario-intensity');
            
            if (stepsInput && intensityInput) {
                const steps = stepsInput.value.trim();
                const intensity = intensityInput.value.trim();
                if (steps || intensity) {
                    parts.push(`${steps}|${intensity}`);
                }
            }
        });
        
        useScenariosTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addUseScenariosRowBtn) {
        console.log('Adding click handler to use scenarios row button');
        addUseScenariosRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add use scenarios row button clicked');
            const newRow = createUseScenariosRow();
            useScenariosTableTbody.appendChild(newRow);
            updateUseScenariosHiddenField();
        });
    } else {
        console.error('Add use scenarios row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    useScenariosTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-use-scenario-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateUseScenariosHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    useScenariosTableTbody.addEventListener('input', function() {
        updateUseScenariosHiddenField();
    });
    
    useScenariosTableTbody.addEventListener('change', function() {
        updateUseScenariosHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingUseScenariosData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateUseScenariosHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
document.addEventListener('DOMContentLoaded', function() {
    const monitoringToolsTableHidden = document.getElementById('monitoring_tools_table');
    const monitoringToolsTableTbody = document.getElementById('monitoring_tools_tbody');
    const addMonitoringToolsRowBtn = document.getElementById('add_monitoring_tools_row_btn');
    
    if (!monitoringToolsTableHidden || !monitoringToolsTableTbody) {
        console.error('Monitoring tools table elements not found');
        return;
    }
    
    console.log('Monitoring tools table script loaded, button:', addMonitoringToolsRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createMonitoringToolsRow(rowData = { name: '', role: '', endpoint: '' }) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                       class="form-control form-control-sm monitoring-tool-name" 
                       name="monitoring_tool_name[]" 
                       value="${rowData.name || ''}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Grafana"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm monitoring-tool-role" 
                       name="monitoring_tool_role[]" 
                       value="${rowData.role || ''}"
                       placeholder="–†–æ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞"
                       required>
            </td>
            <td>
                <input type="text" 
                       class="form-control form-control-sm monitoring-tool-endpoint" 
                       name="monitoring_tool_endpoint[]" 
                       value="${rowData.endpoint || ''}"
                       placeholder="–≠–Ω–¥–ø–æ–∏–Ω—Ç (URI)">
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-monitoring-tool-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingMonitoringToolsData() {
        const monitoringToolsData = monitoringToolsTableHidden.value.trim();
        
        if (!monitoringToolsData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const lines = monitoringToolsData.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('|').map(p => p.trim());
            if (parts.length >= 2) {
                const rowData = {
                    name: parts[0] || '',
                    role: parts[1] || '',
                    endpoint: parts[2] || ''
                };
                const row = createMonitoringToolsRow(rowData);
                monitoringToolsTableTbody.appendChild(row);
            }
        }
        
        updateMonitoringToolsHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateMonitoringToolsHiddenField() {
        const rows = monitoringToolsTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            monitoringToolsTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ|–†–æ–ª—å|–≠–Ω–¥–ø–æ–∏–Ω—Ç (URI)'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const nameInput = row.querySelector('.monitoring-tool-name');
            const roleInput = row.querySelector('.monitoring-tool-role');
            const endpointInput = row.querySelector('.monitoring-tool-endpoint');
            
            if (nameInput && roleInput) {
                const name = nameInput.value.trim();
                const role = roleInput.value.trim();
                const endpoint = endpointInput ? endpointInput.value.trim() : '';
                if (name || role || endpoint) {
                    parts.push(`${name}|${role}|${endpoint}`);
                }
            }
        });
        
        monitoringToolsTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addMonitoringToolsRowBtn) {
        console.log('Adding click handler to monitoring tools row button');
        addMonitoringToolsRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add monitoring tools row button clicked');
            const newRow = createMonitoringToolsRow();
            monitoringToolsTableTbody.appendChild(newRow);
            updateMonitoringToolsHiddenField();
        });
    } else {
        console.error('Add monitoring tools row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    monitoringToolsTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-monitoring-tool-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                updateMonitoringToolsHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    monitoringToolsTableTbody.addEventListener('input', function() {
        updateMonitoringToolsHiddenField();
    });
    
    monitoringToolsTableTbody.addEventListener('change', function() {
        updateMonitoringToolsHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingMonitoringToolsData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateMonitoringToolsHiddenField();
        });
    }
});
</script>
<!-- JavaScript –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ -->
<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const systemResourcesTableHidden = document.getElementById('system_resources_table');
    const systemResourcesTableTbody = document.getElementById('system_resources_tbody');
    const addSystemResourcesRowBtn = document.getElementById('add_system_resources_row_btn');
    
    if (!systemResourcesTableHidden || !systemResourcesTableTbody) {
        console.error('System resources table elements not found');
        return;
    }
    
    console.log('System resources table script loaded, button:', addSystemResourcesRowBtn);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
    function createSystemResourcesRow(rowData = { number: '', metric_type: '', collection_method: '', acquisition_method: '', visualization: '' }) {
        const row = document.createElement('tr');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω
        let rowNumber = rowData.number;
        if (!rowNumber) {
            const existingRows = systemResourcesTableTbody.querySelectorAll('tr');
            rowNumber = (existingRows.length + 1).toString();
        }
        
        row.innerHTML = `
            <td style="text-align: center; vertical-align: middle;">
                <span class="system-resource-number-display" style="font-weight: bold; display: inline-block; min-width: 20px;">${rowNumber}</span>
                <input type="hidden" class="system-resource-number" name="system_resource_number[]" value="${rowNumber}">
            </td>
            <td>
                <textarea class="form-control form-control-sm system-resource-metric-type" 
                       name="system_resource_metric_type[]" 
                       rows="2"
                       placeholder="–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏"
                       required>${rowData.metric_type || ''}</textarea>
            </td>
            <td>
                <textarea class="form-control form-control-sm system-resource-collection-method" 
                       name="system_resource_collection_method[]" 
                       rows="2"
                       placeholder="–°–ø–æ—Å–æ–± —Å–Ω—è—Ç–∏—è"
                       required>${rowData.collection_method || ''}</textarea>
            </td>
            <td>
                <textarea class="form-control form-control-sm system-resource-acquisition-method" 
                       name="system_resource_acquisition_method[]" 
                       rows="2"
                       placeholder="–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è"
                       required>${rowData.acquisition_method || ''}</textarea>
            </td>
            <td>
                <textarea class="form-control form-control-sm system-resource-visualization" 
                       name="system_resource_visualization[]" 
                       rows="2"
                       placeholder="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è">${rowData.visualization || ''}</textarea>
            </td>
            <td style="text-align: center; vertical-align: middle;">
                <button type="button" 
                        class="btn btn-sm btn-danger remove-system-resource-row" 
                        title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        `;
        return row;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫
    function renumberSystemResourcesRows() {
        const rows = systemResourcesTableTbody.querySelectorAll('tr');
        rows.forEach((row, index) => {
            const numberDisplay = row.querySelector('.system-resource-number-display');
            const numberInput = row.querySelector('.system-resource-number');
            const number = (index + 1).toString();
            if (numberDisplay) numberDisplay.textContent = number;
            if (numberInput) numberInput.value = number;
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadExistingSystemResourcesData() {
        const systemResourcesData = systemResourcesTableHidden.value.trim();
        
        if (!systemResourcesData) {
            return; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π
        }
        
        const allLines = systemResourcesData.split('\n');
        if (allLines.length < 2) {
            return; // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ
        }
        
        // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        // –°—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–æ–º–µ—Ä–∞ (—á–∏—Å–ª–æ|), —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∏—á–∏—Ç—å –µ—ë –æ—Ç –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö –ø–æ–ª–µ–π
        const rows = [];
        let currentRowParts = null;
        let currentCollectionMethod = '';
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
        for (let i = 1; i < allLines.length; i++) {
            const line = allLines[i].trim();
            if (!line) continue;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å —á–∏—Å–ª–∞ –∏ | (–Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã)
            const match = line.match(/^(\d+)\|(.*)$/);
            if (match) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å
                if (currentRowParts) {
                    currentRowParts[2] = currentCollectionMethod.trim();
                    if (currentRowParts.length >= 4) {
                        rows.push({
                            number: currentRowParts[0] || '',
                            metric_type: currentRowParts[1] || '',
                            collection_method: currentRowParts[2] || '',
                            acquisition_method: currentRowParts[3] || '',
                            visualization: currentRowParts[4] || ''
                        });
                    }
                }
                // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
                const parts = line.split('|').map(p => p.trim());
                if (parts.length >= 4) {
                    currentRowParts = parts;
                    currentCollectionMethod = parts[2] || '';
                }
            } else if (currentRowParts) {
                // –≠—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –ø–æ–ª—è "–°–ø–æ—Å–æ–± —Å–Ω—è—Ç–∏—è"
                currentCollectionMethod += '\n' + line;
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É
        if (currentRowParts) {
            currentRowParts[2] = currentCollectionMethod.trim();
            if (currentRowParts.length >= 4) {
                rows.push({
                    number: currentRowParts[0] || '',
                    metric_type: currentRowParts[1] || '',
                    collection_method: currentRowParts[2] || '',
                    acquisition_method: currentRowParts[3] || '',
                    visualization: currentRowParts[4] || ''
                });
            }
        }
        
        // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        if (rows.length === 0) {
            const lines = systemResourcesData.split('\n').filter(line => line.trim());
            for (let i = 1; i < lines.length; i++) {
                const parts = lines[i].split('|').map(p => p.trim());
                if (parts.length >= 4) {
                    rows.push({
                        number: parts[0] || '',
                        metric_type: parts[1] || '',
                        collection_method: parts[2] || '',
                        acquisition_method: parts[3] || '',
                        visualization: parts[4] || ''
                    });
                }
            }
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        rows.forEach(rowData => {
            const row = createSystemResourcesRow(rowData);
            systemResourcesTableTbody.appendChild(row);
        });
        
        renumberSystemResourcesRows();
        updateSystemResourcesHiddenField();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    function updateSystemResourcesHiddenField() {
        const rows = systemResourcesTableTbody.querySelectorAll('tr');
        if (rows.length === 0) {
            systemResourcesTableHidden.value = '';
            return;
        }
        
        const parts = [];
        parts.push('‚Ññ|–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏|–°–ø–æ—Å–æ–± —Å–Ω—è—Ç–∏—è|–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è|–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è'); // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        
        rows.forEach(row => {
            const numberInput = row.querySelector('.system-resource-number');
            const metricTypeInput = row.querySelector('.system-resource-metric-type');
            const collectionMethodInput = row.querySelector('.system-resource-collection-method');
            const acquisitionMethodInput = row.querySelector('.system-resource-acquisition-method');
            const visualizationInput = row.querySelector('.system-resource-visualization');
            
            if (numberInput && metricTypeInput && collectionMethodInput && acquisitionMethodInput) {
                const number = numberInput.value.trim();
                const metricType = metricTypeInput.value.trim();
                const collectionMethod = collectionMethodInput.value.trim();
                const acquisitionMethod = acquisitionMethodInput.value.trim();
                const visualization = visualizationInput ? visualizationInput.value.trim() : '';
                if (metricType || collectionMethod || acquisitionMethod || visualization) {
                    parts.push(`${number}|${metricType}|${collectionMethod}|${acquisitionMethod}|${visualization}`);
                }
            }
        });
        
        systemResourcesTableHidden.value = parts.join('\n');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (addSystemResourcesRowBtn) {
        console.log('Adding click handler to system resources row button');
        addSystemResourcesRowBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Add system resources row button clicked');
            const newRow = createSystemResourcesRow();
            systemResourcesTableTbody.appendChild(newRow);
            renumberSystemResourcesRows();
            updateSystemResourcesHiddenField();
        });
    } else {
        console.error('Add system resources row button not found!');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    systemResourcesTableTbody.addEventListener('click', function(e) {
        if (e.target.closest('.remove-system-resource-row')) {
            const row = e.target.closest('tr');
            if (row) {
                row.remove();
                renumberSystemResourcesRows();
                updateSystemResourcesHiddenField();
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    systemResourcesTableTbody.addEventListener('input', function() {
        updateSystemResourcesHiddenField();
    });
    
    systemResourcesTableTbody.addEventListener('change', function() {
        updateSystemResourcesHiddenField();
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadExistingSystemResourcesData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form[action*="/mnt/"]');
    if (form) {
        form.addEventListener('submit', function() {
            updateSystemResourcesHiddenField();
        });
    }
});
</script>
{% if unpublished_changes and unpublished_changes|length > 0 %}
<script id="unpublished-changes-data" type="application/json">{{ unpublished_changes|tojson|safe }}</script>
<script src="/static/js/highlight-changes.js"></script>
<script>
// –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
console.log('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: unpublished_changes –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ —à–∞–±–ª–æ–Ω:', {{ unpublished_changes|length }});
</script>
{% else %}
<script>
console.log('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: unpublished_changes –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –ø—É—Å—Ç—ã');
console.log('unpublished_changes:', {{ unpublished_changes|tojson|safe if unpublished_changes else 'null' }});
</script>
{% endif %}
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–æ–ª–µ–π, –≥–¥–µ —ç—Ç–æ –Ω—É–∂–Ω–æ
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã —Ç–∞–±–ª–∏—Ü
    // history_changes_table - –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è, –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    // approval_list_table - –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å input –ø–æ–ª—è–º–∏
    const tableFields = [
        // 'approval_list_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'abbreviations_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'terminology_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'risks_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'stand_comparison_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'planned_tests_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'database_preparation_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'load_profiles_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'use_scenarios_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'monitoring_tools_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        // 'system_resources_table', // –£–±—Ä–∞–ª–∏, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        'business_metrics_table',
        'deliverables_table',
        'contacts_table'
    ];
    
    tableFields.forEach(fieldId => {
        if (document.getElementById(fieldId)) {
            new TableEditor(fieldId);
        }
    });
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è - –ø–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ–∫–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã)
    document.querySelectorAll('.form-navigation .nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault(); // –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
            const href = this.getAttribute('href');
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —è–∫–æ—Ä—è (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #)
            if (href && href.startsWith('#')) {
                const targetId = href.substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —É—á–µ—Ç–æ–º offset –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - 80; // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É
                    
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞
                    document.querySelectorAll('.form-navigation .nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    history.pushState(null, null, href);
                } else {
                    console.warn(`–≠–ª–µ–º–µ–Ω—Ç —Å id="${targetId}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                }
            }
            // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (–Ω–µ —è–∫–æ—Ä–µ–π) –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º - –ø—É—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ
        });
    });
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
    const sections = document.querySelectorAll('.form-section[id]');
    const navItems = document.querySelectorAll('.form-navigation .nav-item[href^="#"]');
    
    function updateActiveNav() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (window.pageYOffset >= sectionTop - 150) {
                current = section.getAttribute('id');
            }
        });
        
        navItems.forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('href') === '#' + current) {
                item.classList.add('active');
            }
        });
    }
    
    window.addEventListener('scroll', updateActiveNav);
    updateActiveNav();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
    /*
    let customSectionCounter = 0;
    const customSectionsContainer = document.getElementById('custom-sections-container');
    const addCustomSectionBtn = document.getElementById('add-custom-section-btn');
    
    function loadExistingCustomSections() {
        {% if data and data.custom_sections %}
        const customSections = {{ data.custom_sections | tojson }};
        customSections.forEach(function(section) {
            const sectionId = section.id || `custom-${Date.now()}`;
            const sectionHtml = createCustomSectionHTML(sectionId, section);
            customSectionsContainer.insertAdjacentHTML('beforeend', sectionHtml);
            
            const tableFieldId = `custom_table_${sectionId}`;
            if (typeof TableEditor !== 'undefined') {
                setTimeout(() => {
                    const tableField = document.getElementById(tableFieldId);
                    if (tableField) {
                        new TableEditor(tableFieldId);
                    }
                }, 100);
            }
            
            addToNavigation(`custom-section-${sectionId}`, section.title || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫');
        });
        {% endif %}
    }
    
    function createCustomSectionHTML(sectionId, sectionData) {
        const title = sectionData.title || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–ª–æ–∫';
        const position = sectionData.position || 15;
        const text = sectionData.text || '';
        const table = sectionData.table || '';
        const list = sectionData.list || '';
        const uniqueId = sectionData.id || sectionId || `custom-${Date.now()}`;
        
        return `
            <div class="form-section custom-section" id="custom-section-${uniqueId}" data-section-id="${uniqueId}" data-position="${position}">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>${title.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</h3>
                    <button type="button" class="btn btn-sm btn-danger remove-custom-section" data-section-id="${uniqueId}">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
                
                <input type="hidden" name="custom_sections[${uniqueId}][id]" value="${uniqueId}">
                <input type="hidden" name="custom_sections[${uniqueId}][title]" value="${title.replace(/"/g, '&quot;')}">
                <input type="hidden" name="custom_sections[${uniqueId}][position]" value="${position}">
                
                <div class="mb-3">
                    <label class="form-label">–¢–µ–∫—Å—Ç</label>
                    <textarea class="form-control" name="custom_sections[${uniqueId}][text]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞">${text.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">–¢–∞–±–ª–∏—Ü–∞</label>
                    <textarea class="form-control" id="custom_table_${uniqueId}" name="custom_sections[${uniqueId}][table]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É">${table.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    <small class="text-muted">–§–æ—Ä–º–∞—Ç: –ó–∞–≥–æ–ª–æ–≤–æ–∫1|–ó–∞–≥–æ–ª–æ–≤–æ–∫2, –î–∞–Ω–Ω—ã–µ1|–î–∞–Ω–Ω—ã–µ2</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">–°–ø–∏—Å–æ–∫ (–∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
                    <textarea class="form-control" name="custom_sections[${uniqueId}][list]" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞">${list.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                </div>
            </div>
        `;
    }
    
    if (addCustomSectionBtn && customSectionsContainer) {
        loadExistingCustomSections();
        
        addCustomSectionBtn.addEventListener('click', function() {
            const title = document.getElementById('custom_section_title').value.trim();
            const insertAfter = parseInt(document.getElementById('custom_section_insert_after').value);
            
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞');
                return;
            }
            
            customSectionCounter++;
            const sectionId = `custom-section-${customSectionCounter}`;
            const timestamp = Date.now();
            
            const sectionData = {
                id: timestamp,
                title: title,
                position: insertAfter,
                text: '',
                table: '',
                list: ''
            };
            
            const sectionHtml = createCustomSectionHTML(timestamp, sectionData);
            customSectionsContainer.insertAdjacentHTML('beforeend', sectionHtml);
            
            if (typeof TableEditor !== 'undefined') {
                const tableEditorId = `custom_table_${timestamp}`;
                setTimeout(() => {
                    const tableField = document.getElementById(tableEditorId);
                    if (tableField) {
                        new TableEditor(tableEditorId);
                    }
                }, 100);
            }
            
            addToNavigation(sectionId, title);
            document.getElementById('custom_section_title').value = '';
            updateActiveNav();
        });
        
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-custom-section')) {
                const sectionId = e.target.getAttribute('data-section-id');
                const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                if (section && confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫?')) {
                    const navItem = document.querySelector(`[data-nav-custom="custom-section-${sectionId}"]`);
                    if (navItem) navItem.remove();
                    section.remove();
                }
            }
        });
        
        function addToNavigation(sectionId, title) {
            const navContainer = document.querySelector('.form-navigation .nav-container');
            if (!navContainer) return;
            
            const navItem = document.createElement('div');
            navItem.className = 'nav-section';
            navItem.setAttribute('data-nav-custom', sectionId);
            navItem.innerHTML = `<a href="#${sectionId}" class="nav-item">${title.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</a>`;
            
            const publishNav = Array.from(navContainer.children).find(el => 
                el.querySelector('a[href="#section-confluence"]')
            );
            
            if (publishNav) {
                navContainer.insertBefore(navItem, publishNav);
            } else {
                navContainer.appendChild(navItem);
            }
        }
    }
    */
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞
document.addEventListener('DOMContentLoaded', function() {
    const createTagForm = document.getElementById('createTagForm');
    if (createTagForm) {
        createTagForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/api/tags', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    const modal = bootstrap.Modal.getInstance(document.getElementById('createTagModal'));
                    if (modal) modal.hide();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∞
                    location.reload();
                } else {
                    const errorData = await response.json();
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞: ' + (errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞: ' + error.message);
            }
        });
    }
});

</script>
{% endblock %}
