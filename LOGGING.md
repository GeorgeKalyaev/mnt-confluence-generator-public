# Система логирования

## Обзор

В приложении реализована комплексная система логирования всех операций и действий пользователей.

## Что логируется

### 1. HTTP запросы
- Все входящие HTTP запросы (метод, путь, статус, время выполнения)
- Query параметры
- IP адрес пользователя
- Request ID для отслеживания цепочки запросов

### 2. Действия пользователя
- Открытие страниц (создание, редактирование, список)
- Создание МНТ (с деталями проекта, автора)
- Редактирование МНТ
- Публикация в Confluence
- Сохранение черновиков
- Удаление и восстановление МНТ

### 3. Операции с МНТ
- Создание, обновление, удаление
- Публикация в Confluence
- Ошибки при операциях

### 4. Операции с Confluence
- Создание страниц
- Обновление страниц
- Загрузка изображений
- Удаление страниц
- Ошибки API

### 5. Ошибки
- Все исключения с полным стеком вызовов
- Контекст ошибки (request ID, IP, пользователь)

## Формат логов

Логи записываются в файл `logs/app_YYYY-MM.log` в формате:

```
YYYY-MM-DD HH:MM:SS - mnt_generator - LEVEL - [RequestID=xxx | IP=xxx | User=xxx] Сообщение
```

## Уровни логирования

- **DEBUG** - детальная информация для отладки
- **INFO** - важные события (создание МНТ, публикация)
- **WARNING** - предупреждения
- **ERROR** - ошибки с полным стеком

## Примеры логов

```
2026-01-16 22:30:15 - mnt_generator - INFO - [RequestID=a1b2c3d4 | IP=192.168.1.1 | User=Иванов И.И.] ВХОДЯЩИЙ ЗАПРОС | GET /mnt/create
2026-01-16 22:30:20 - mnt_generator - INFO - [RequestID=a1b2c3d4 | IP=192.168.1.1 | User=Иванов И.И.] ДЕЙСТВИЕ | Открыта страница создания МНТ | URL: /mnt/create
2026-01-16 22:31:00 - mnt_generator - INFO - [RequestID=e5f6g7h8 | IP=192.168.1.1 | User=Иванов И.И.] НАЧАЛО СОЗДАНИЯ МНТ | Проект: Проект1 | Автор: Иванов И.И. | Действие: публикация
2026-01-16 22:31:05 - mnt_generator - INFO - [RequestID=e5f6g7h8 | IP=192.168.1.1 | User=Иванов И.И.] МНТ УСПЕШНО СОЗДАН | ID: 123 | Проект: Проект1 | Название: МНТ для Проект1
2026-01-16 22:31:10 - mnt_generator - INFO - [RequestID=e5f6g7h8 | IP=192.168.1.1 | User=Иванов И.И.] Confluence | МНТ #123 | Создание страницы | УСПЕХ
2026-01-16 22:31:15 - mnt_generator - INFO - [RequestID=e5f6g7h8 | IP=192.168.1.1 | User=Иванов И.И.] ЗАВЕРШЕНО СОЗДАНИЕ МНТ | ID: 123 | Статус: опубликован
```

## Request ID

Каждый HTTP запрос получает уникальный Request ID, который позволяет отследить все логи, связанные с одним запросом.

## Контекст

В каждый лог автоматически добавляется:
- **Request ID** - уникальный идентификатор запроса
- **IP адрес** - IP адрес пользователя
- **User** - имя пользователя (если доступно)

## Файлы логов

Логи сохраняются в директории `logs/` с именем файла `app_YYYY-MM.log` (например, `app_2026-01.log`).

Файлы автоматически ротируются по месяцам.
